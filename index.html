<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Macåº”ç”¨æ‰«æå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #00b894 100%);
            background-attachment: fixed;
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* èƒŒæ™¯ç²’å­æ•ˆæœ */
        .background-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
            transform: translateY(-100px) rotate(360deg);
            opacity: 0;
        }
    }

    /* Footeræ ·å¼ */
    footer a {
        transition: all 0.3s ease;
    }

    footer a:hover {
        color: rgba(255, 255, 255, 1) !important;
        transform: translateY(-2px);
    }        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #2c3e50;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            color: #6c757d;
        }

        /* å¯¼å…¥åŒºåŸŸæ ·å¼ */
        .drop-zone {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 60px 40px;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            transition: all 0.3s ease;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .drop-zone.dragover {
            border-color: #007bff;
            background: rgba(0, 123, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .drop-zone h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .drop-zone p {
            color: #6c757d;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .file-input {
            display: none;
        }

        .file-input-btn {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .file-input-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .file-input-btn.demo-btn {
            background: #28a745;
            margin-left: 15px;
        }

        .file-input-btn.demo-btn:hover {
            background: #218838;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        /* ç»“æœæ˜¾ç¤ºåŒºåŸŸ */
        .results-container {
            display: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #007bff;
            display: block;
        }

        .stat-label {
            font-size: 1.1rem;
            color: #666;
            margin-top: 10px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 500;
            color: #333;
        }

        select, input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .view-toggle {
            margin-left: auto;
        }

        .toggle-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 5px;
            font-weight: 500;
        }

        .toggle-btn.active {
            background: #007bff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }

        .toggle-btn:hover:not(.active) {
            background: #5a6268;
        }

        /* åº”ç”¨åˆ—è¡¨æ ·å¼ */
        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .app-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 4px solid #007bff;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .app-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .app-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .app-info {
            display: grid;
            gap: 5px;
            font-size: 0.9rem;
            color: #666;
        }

        .app-category {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-top: 10px;
            font-weight: 500;
        }

        /* è¯äº‘å®¹å™¨ */
        .wordcloud-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 30px;
            position: relative;
            min-height: 600px;
        }

        /* åˆ†ç±»ç»Ÿè®¡æ¡å½¢å›¾ */
        .category-bar {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            border-radius: 8px;
            background: rgba(0,0,0,0.02);
        }

        .category-label {
            width: 120px;
            text-align: left;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .category-bar-fill {
            height: 20px;
            border-radius: 10px;
            margin: 0 10px;
            flex: 1;
            max-width: 300px;
            position: relative;
            display: flex;
            align-items: center;
            padding: 0 8px;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .category-count {
            width: 40px;
            text-align: right;
            font-weight: bold;
            color: #333;
        }

        #wordcloud {
            width: 100%;
            height: 800px;
            margin: 20px 0;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            max-width: 100%;
        }
        
        /* ä¿å­˜æŒ‰é’®æ ·å¼ */
        .save-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .save-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .save-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* ä¸‹è½½æŒ‰é’®æ ·å¼ - ç»Ÿä¸€æŒ‰é’®é£æ ¼ */
        .download-script-btn {
            background: #20c997;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            margin-left: 15px;
        }
        
        .download-script-btn:hover {
            background: #1ea085;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(32, 201, 151, 0.3);
        }

        /* å®‰å…¨æç¤ºæ ·å¼ */
        .security-notice {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(32, 201, 151, 0.1) 100%);
            border: 2px solid rgba(40, 167, 69, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .security-notice h3 {
            color: #28a745;
            margin: 0 0 10px 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .security-notice p {
            margin: 8px 0;
            color: #333;
            line-height: 1.5;
        }

        .security-notice .highlight {
            background: rgba(40, 167, 69, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading {
            text-align: center;
            color: #6c757d;
            font-size: 1.2rem;
            margin: 40px 0;
        }

        .loading::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .view-toggle {
                margin-left: 0;
                margin-top: 10px;
            }
            
            .apps-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <!-- å¼•å…¥WordCloud.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js"></script>
    
    <!-- GitHub Pages æ”¯æŒ -->
    <script>
        // æ£€æµ‹æ˜¯å¦åœ¨GitHub Pagesç¯å¢ƒ
        const isGitHubPages = window.location.hostname.includes('github.io');
        const basePath = isGitHubPages ? '/Share-Your-Mac-APP' : '';
        
        // è®¾ç½®åŸºç¡€è·¯å¾„ç”¨äºèµ„æºåŠ è½½
        if (isGitHubPages) {
            console.log('è¿è¡Œåœ¨ GitHub Pages ç¯å¢ƒ');
        }
    </script>
</head>
<body>
    <!-- èƒŒæ™¯ç²’å­æ•ˆæœ -->
    <div class="background-particles" id="particles"></div>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ Macåº”ç”¨æ‰«æå™¨</h1>
            <p>æ‰«æå¹¶å±•ç¤ºä½ çš„Macä¸Šå®‰è£…çš„æ‰€æœ‰åº”ç”¨ç¨‹åº</p>
            <div style="margin-top: 15px; padding: 15px; background: rgba(0,123,255,0.1); border-radius: 10px; font-size: 0.9rem;">
                âœ¨ <strong>æ–°åŠŸèƒ½:</strong> æ™ºèƒ½åˆ†ç±»ç³»ç»Ÿã€ç¾åŒ–ç•Œé¢è®¾è®¡ã€å¤šè§†å›¾å±•ç¤º
            </div>
        </div>

        <!-- æ–‡ä»¶å¯¼å…¥åŒºåŸŸ -->
        <div id="import-section">
            <div class="drop-zone" id="dropZone">
                <h2>ğŸ“± å¯¼å…¥æ‰«æç»“æœ</h2>
                <p>å°† apps_data.json æ–‡ä»¶æ‹–æ‹½åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©æ–‡ä»¶</p>
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" class="file-input" accept=".json">
                    <button class="file-input-btn" onclick="document.getElementById('fileInput').click()">
                        é€‰æ‹©æ–‡ä»¶
                    </button>
                    <button class="file-input-btn demo-btn" onclick="loadDemo()">
                        ğŸ® åŠ è½½æ¼”ç¤ºæ•°æ®
                    </button>
                    <button class="download-script-btn" onclick="downloadScanScript()">
                        ğŸ“¥ ä¸‹è½½æ‰«æè„šæœ¬
                    </button>
                </div>
                
                <!-- å®‰å…¨æç¤º -->
                <div class="security-notice">
                    <h3>ğŸ›¡ï¸ å®‰å…¨ä¿è¯</h3>
                    <p>â€¢ <span class="highlight">å®Œå…¨å®‰å…¨</span>ï¼šè„šæœ¬åªè¯»å–åº”ç”¨ä¿¡æ¯ï¼Œä¸ä¼šä¿®æ”¹æˆ–åˆ é™¤ä»»ä½•æ–‡ä»¶</p>
                    <p>â€¢ <span class="highlight">æ— éœ€æ‹…å¿ƒ</span>ï¼šæ‰€æœ‰æ•°æ®éƒ½åœ¨æœ¬åœ°å¤„ç†ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨</p>
                    <p>â€¢ <span class="highlight">å¼€æºé€æ˜</span>ï¼šæ‚¨å¯ä»¥æŸ¥çœ‹è„šæœ¬æºä»£ç ï¼Œç¡®ä¿å®‰å…¨å¯é </p>
                    <p>â€¢ <span class="highlight">ç®€å•æ˜“ç”¨</span>ï¼šä¸‹è½½è„šæœ¬ååœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼Œç”Ÿæˆçš„æ–‡ä»¶ç›´æ¥æ‹–åˆ°ç½‘é¡µå³å¯</p>
                </div>
                
                <p style="margin-top: 20px; font-size: 0.9rem;">
                    ğŸ’¡ ä½¿ç”¨æ­¥éª¤ï¼š<span class="highlight">ä¸‹è½½è„šæœ¬</span> â†’ <span class="highlight">ç»ˆç«¯è¿è¡Œ chmod +x scan_apps.sh && ./scan_apps.sh</span> â†’ <span class="highlight">æ‹–æ‹½ç”Ÿæˆçš„æ–‡ä»¶åˆ°ç½‘é¡µ</span>ï¼Œæˆ–ç‚¹å‡»"åŠ è½½æ¼”ç¤ºæ•°æ®"ä½“éªŒåŠŸèƒ½
                </p>
            </div>
        </div>

        <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
        <div id="results-section" class="results-container">
            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="totalApps">0</span>
                    <div class="stat-label">æ€»åº”ç”¨æ•°</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="totalCategories">0</span>
                    <div class="stat-label">åº”ç”¨åˆ†ç±»</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="scanDate">-</span>
                    <div class="stat-label">æ‰«ææ—¶é—´</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="systemInfo">-</span>
                    <div class="stat-label">ç³»ç»Ÿä¿¡æ¯</div>
                </div>
            </div>

            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="controls">
                <div class="control-group">
                    <label for="categoryFilter">åˆ†ç±»ç­›é€‰:</label>
                    <select id="categoryFilter">
                        <option value="">æ‰€æœ‰åˆ†ç±»</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="searchBox">æœç´¢:</label>
                    <input type="text" id="searchBox" placeholder="è¾“å…¥åº”ç”¨åç§°...">
                </div>
                <div class="view-toggle">
                    <button class="toggle-btn active" id="listViewBtn">ğŸ“‹ åˆ—è¡¨è§†å›¾</button>
                    <button class="toggle-btn" id="cloudViewBtn">â˜ï¸ è¯äº‘è§†å›¾</button>
                    <button class="toggle-btn" id="chartViewBtn">ğŸ“Š ç»Ÿè®¡è§†å›¾</button>
                </div>
            </div>

            <!-- åº”ç”¨åˆ—è¡¨ -->
            <div id="apps-list" class="apps-grid"></div>

            <!-- è¯äº‘è§†å›¾ -->
            <div id="wordcloud-section" class="wordcloud-container">
                <button id="saveWordCloudBtn" class="save-button" onclick="saveWordCloudImage()" style="display: none;">
                    ğŸ’¾ ä¿å­˜å›¾ç‰‡
                </button>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>ğŸ“Š åº”ç”¨è¯äº‘</h2>
                    <div>
                        <button id="wordcloudToggle" class="toggle-btn" onclick="toggleWordCloudType()">
                            åˆ‡æ¢æ ·å¼
                        </button>
                        <button id="regenerateBtn" class="toggle-btn" onclick="regenerateWordCloud()" style="background: #17a2b8;">
                            ğŸ”„ é‡æ–°ç”Ÿæˆ
                        </button>
                    </div>
                </div>
                <p>æ ¹æ®åº”ç”¨åç§°å’Œåˆ†ç±»ç”Ÿæˆçš„å¯è§†åŒ–è¯äº‘</p>
                <canvas id="wordcloud"></canvas>
                <div style="margin-top: 20px; font-size: 0.9rem; color: #666;">
                    ğŸ’¡ ä¸åŒé¢œè‰²ä»£è¡¨ä¸åŒåº”ç”¨åˆ†ç±»ï¼Œå­—ä½“å¤§å°åæ˜ åº”ç”¨é‡è¦æ€§<br>
                    ğŸ“¸ ç”Ÿæˆè¯äº‘åå¯ç‚¹å‡»å³ä¸Šè§’"ä¿å­˜å›¾ç‰‡"æŒ‰é’®ä¸‹è½½é«˜æ¸…å›¾ç‰‡<br>
                    ğŸ¨ æ”¯æŒå¤šç§æ˜¾ç¤ºæ ·å¼ï¼Œå¯ç‚¹å‡»"åˆ‡æ¢æ ·å¼"æˆ–"é‡æ–°ç”Ÿæˆ"è·å¾—ä¸åŒæ•ˆæœ
                </div>
            </div>

            <!-- åˆ†ç±»ç»Ÿè®¡å›¾è¡¨ -->
            <div id="category-chart" class="wordcloud-container">
                <h2>ğŸ“ˆ åˆ†ç±»ç»Ÿè®¡</h2>
                <p>å±•ç¤ºå„ä¸ªåº”ç”¨åˆ†ç±»çš„æ•°é‡åˆ†å¸ƒ</p>
                <div id="categoryStats" style="margin: 20px 0;"></div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ç‰ˆæƒä¿¡æ¯ -->
    <footer style="text-align: center; padding: 40px 20px; margin-top: 60px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-top: 1px solid rgba(255, 255, 255, 0.2);">
        <div style="max-width: 800px; margin: 0 auto;">
            <p style="margin: 0 0 10px 0; font-size: 1.1rem; font-weight: 500; color: rgba(255, 255, 255, 0.9);">
                ğŸ Macåº”ç”¨æ‰«æå™¨
            </p>
            <p style="margin: 0 0 15px 0; font-size: 0.9rem; color: rgba(255, 255, 255, 0.7);">
                ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„Macåº”ç”¨ç¨‹åºæ‰«æä¸å¯è§†åŒ–å·¥å…·
            </p>
            <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-bottom: 20px;">
                <a href="https://github.com/xiebaiyuan/Share-Your-Mac-APP" target="_blank" 
                   style="color: rgba(255, 255, 255, 0.8); text-decoration: none; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; transition: color 0.3s ease;">
                    <span>ğŸ“‚</span> GitHub ä»“åº“
                </a>
                <span style="color: rgba(255, 255, 255, 0.5);">|</span>
                <span style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                    ğŸ‘¨â€ğŸ’» ä½œè€…: <a href="https://github.com/xiebaiyuan" target="_blank" style="color: rgba(255, 255, 255, 0.8); text-decoration: none;">xiebaiyuan</a>
                </span>
            </div>
            <p style="margin: 0; font-size: 0.8rem; color: rgba(255, 255, 255, 0.6);">
                Â© 2025 Share-Your-Mac-APP. åŸºäº MIT è®¸å¯è¯å¼€æº
            </p>
        </div>
    </footer>

    <script>
        let appsData = null;
        let filteredApps = [];

        // Demoæ•°æ® - åŸºäºæ‚¨çš„å®é™…åº”ç”¨æ•°æ®çš„ç²¾é€‰æ ·æœ¬
        const demoData = {
            "scan_info": {
                "scan_date": "2025-08-12 19:51:50",
                "hostname": "Demo-MacBook-Pro",
                "username": "demo_user",
                "total_apps": 45
            },
            "applications": [
                {
                    "name": "Visual Studio Code",
                    "version": "1.103.0",
                    "bundle_id": "com.microsoft.VSCode",
                    "size": "400M",
                    "install_date": "2025-07-25 20:41:14",
                    "category": "Development",
                    "path": "/Applications/Visual Studio Code.app"
                },
                {
                    "name": "Xcode",
                    "version": "16.0",
                    "bundle_id": "com.apple.dt.Xcode",
                    "size": "4.8G",
                    "install_date": "2024-09-24 16:30:52",
                    "category": "Development",
                    "path": "/Applications/Xcode.app"
                },
                {
                    "name": "ChatGPT",
                    "version": "1.2025.217",
                    "bundle_id": "com.openai.chat",
                    "size": "108M",
                    "install_date": "2025-08-12 11:35:46",
                    "category": "AI Tools",
                    "path": "/Applications/ChatGPT.app"
                },
                {
                    "name": "Claude",
                    "version": "0.9.3",
                    "bundle_id": "com.anthropic.claudefordesktop",
                    "size": "266M",
                    "install_date": "2025-04-30 23:49:11",
                    "category": "AI Tools",
                    "path": "/Applications/Claude.app"
                },
                {
                    "name": "Google Chrome",
                    "version": "137.0.7151.69",
                    "bundle_id": "com.google.Chrome",
                    "size": "1.8G",
                    "install_date": "2024-05-17 02:38:04",
                    "category": "Browsers",
                    "path": "/Applications/Google Chrome.app"
                },
                {
                    "name": "Safari",
                    "version": "18.4",
                    "bundle_id": "com.apple.Safari",
                    "size": "0B",
                    "install_date": "2025-03-27 19:00:33",
                    "category": "Browsers",
                    "path": "/Applications/Safari.app"
                },
                {
                    "name": "WeChat",
                    "version": "4.0.6",
                    "bundle_id": "com.tencent.xinWeChat",
                    "size": "1.0G",
                    "install_date": "2025-07-23 14:12:11",
                    "category": "Communication",
                    "path": "/Applications/WeChat.app"
                },
                {
                    "name": "Telegram",
                    "version": "11.15",
                    "bundle_id": "ru.keepcoder.Telegram",
                    "size": "298M",
                    "install_date": "2025-08-04 10:24:18",
                    "category": "Communication",
                    "path": "/Applications/Telegram.app"
                },
                {
                    "name": "Discord",
                    "version": "0.0.355",
                    "bundle_id": "com.hnc.Discord",
                    "size": "431M",
                    "install_date": "2025-07-28 10:28:46",
                    "category": "Communication",
                    "path": "/Applications/Discord.app"
                },
                {
                    "name": "Notion",
                    "version": "4.17.0",
                    "bundle_id": "notion.id",
                    "size": "255M",
                    "install_date": "2025-08-06 22:23:32",
                    "category": "Productivity",
                    "path": "/Applications/Notion.app"
                },
                {
                    "name": "Obsidian",
                    "version": "1.7.7",
                    "bundle_id": "md.obsidian",
                    "size": "271M",
                    "install_date": "2024-11-17 09:49:33",
                    "category": "Productivity",
                    "path": "/Applications/Obsidian.app"
                },
                {
                    "name": "1Password",
                    "version": "8.11.4",
                    "bundle_id": "com.1password.1password",
                    "size": "430M",
                    "install_date": "2025-08-06 12:04:53",
                    "category": "Security",
                    "path": "/Applications/1Password.app"
                },
                {
                    "name": "Docker",
                    "version": "4.40.0",
                    "bundle_id": "com.docker.docker",
                    "size": "1.8G",
                    "install_date": "2025-03-29 22:28:19",
                    "category": "Virtualization",
                    "path": "/Applications/Docker.app"
                },
                {
                    "name": "IINA",
                    "version": "1.3.5",
                    "bundle_id": "com.colliderli.iina",
                    "size": "159M",
                    "install_date": "2024-05-31 09:19:32",
                    "category": "Media",
                    "path": "/Applications/IINA.app"
                },
                {
                    "name": "Raycast",
                    "version": "1.102.3",
                    "bundle_id": "com.raycast.macos",
                    "size": "122M",
                    "install_date": "2025-07-31 20:08:28",
                    "category": "Utilities",
                    "path": "/Applications/Raycast.app"
                },
                {
                    "name": "Microsoft Excel",
                    "version": "16.73",
                    "bundle_id": "com.microsoft.Excel",
                    "size": "2.0G",
                    "install_date": "2023-05-29 16:06:12",
                    "category": "Microsoft",
                    "path": "/Applications/Microsoft Excel.app"
                },
                {
                    "name": "Microsoft Word",
                    "version": "16.73",
                    "bundle_id": "com.microsoft.Word",
                    "size": "2.3G",
                    "install_date": "2023-05-29 16:06:12",
                    "category": "Microsoft",
                    "path": "/Applications/Microsoft Word.app"
                },
                {
                    "name": "Parallels Desktop",
                    "version": "20.1.3",
                    "bundle_id": "com.parallels.desktop.console",
                    "size": "381M",
                    "install_date": "2024-12-17 06:17:05",
                    "category": "Virtualization",
                    "path": "/Applications/Parallels Desktop.app"
                },
                {
                    "name": "Photoshop",
                    "version": "25.0.0",
                    "bundle_id": "com.adobe.Photoshop",
                    "size": "3.2G",
                    "install_date": "2024-08-15 14:30:20",
                    "category": "Design",
                    "path": "/Applications/Adobe Photoshop 2024/Adobe Photoshop 2024.app"
                },
                {
                    "name": "Finder",
                    "version": "12.7",
                    "bundle_id": "com.apple.finder",
                    "size": "8.5M",
                    "install_date": "2025-03-27 19:00:33",
                    "category": "System",
                    "path": "/System/Library/CoreServices/Finder.app"
                }
            ]
        };

        // åŠ è½½Demoæ•°æ®
        function loadDemo() {
            appsData = JSON.parse(JSON.stringify(demoData)); // æ·±æ‹·è´
            displayResults();
            
            // æ˜¾ç¤ºDemoæç¤º
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.innerHTML = `
                    <div style="position: fixed; top: 20px; right: 20px; background: rgba(40, 167, 69, 0.95); color: white; padding: 15px 20px; border-radius: 10px; z-index: 1000; backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
                        âœ… Demoæ•°æ®åŠ è½½æˆåŠŸï¼æ‚¨å¯ä»¥ä½“éªŒå„ç§åŠŸèƒ½
                    </div>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }, 500);
        }

        // DOMå…ƒç´ 
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const importSection = document.getElementById('import-section');
        const resultsSection = document.getElementById('results-section');
        const categoryFilter = document.getElementById('categoryFilter');
        const searchBox = document.getElementById('searchBox');
        const listViewBtn = document.getElementById('listViewBtn');
        const cloudViewBtn = document.getElementById('cloudViewBtn');
        const chartViewBtn = document.getElementById('chartViewBtn');
        const appsList = document.getElementById('apps-list');
        const wordcloudSection = document.getElementById('wordcloud-section');
        const categoryChart = document.getElementById('category-chart');

        // æ–‡ä»¶æ‹–æ‹½å¤„ç†
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // å¤„ç†æ–‡ä»¶
        function handleFile(file) {
            if (!file.name.endsWith('.json')) {
                alert('è¯·é€‰æ‹©JSONæ–‡ä»¶ï¼');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    appsData = JSON.parse(e.target.result);
                    displayResults();
                } catch (error) {
                    alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·ç¡®ä¿æ˜¯æœ‰æ•ˆçš„JSONæ–‡ä»¶ï¼');
                    console.error('è§£æé”™è¯¯:', error);
                }
            };
            reader.readAsText(file);
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults() {
            // éšè—å¯¼å…¥åŒºåŸŸï¼Œæ˜¾ç¤ºç»“æœåŒºåŸŸ
            importSection.style.display = 'none';
            resultsSection.style.display = 'block';
            resultsSection.classList.add('fade-in');

            // é‡æ–°åˆ†ç±»åº”ç”¨
            reclassifyApps();

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats();
            
            // å¡«å……åˆ†ç±»ç­›é€‰å™¨
            populateCategoryFilter();
            
            // æ˜¾ç¤ºåº”ç”¨åˆ—è¡¨
            filteredApps = appsData.applications;
            displayApps();
            
            // æ˜¾ç¤ºåˆ†ç±»ç»Ÿè®¡
            displayCategoryStats();
        }

        // é‡æ–°åˆ†ç±»åº”ç”¨ï¼Œå‡å°‘Otheråˆ†ç±»
        function reclassifyApps() {
            appsData.applications.forEach(app => {
                if (app.category === 'Other') {
                    app.category = getImprovedCategory(app.name, app.bundle_id);
                }
            });
        }

        // æ”¹è¿›çš„åˆ†ç±»é€»è¾‘
        function getImprovedCategory(appName, bundleId) {
            const name = appName.toLowerCase();
            const bundle = bundleId ? bundleId.toLowerCase() : '';

            // å¼€å‘å·¥å…·
            if (name.includes('xcode') || name.includes('code') || name.includes('developer') || 
                name.includes('cursor') || name.includes('sublime') || name.includes('jetbrains') ||
                name.includes('deveco') || name.includes('android') || name.includes('studio') ||
                bundle.includes('developer') || bundle.includes('deveco') || bundle.includes('xcode')) {
                return 'Development';
            }

            // é€šè®¯å·¥å…·
            if (name.includes('wechat') || name.includes('qq') || name.includes('telegram') || 
                name.includes('discord') || name.includes('chat') || name.includes('å¦‚æµ') ||
                bundle.includes('chat') || bundle.includes('tencent') || bundle.includes('telegram')) {
                return 'Communication';
            }

            // åª’ä½“å·¥å…·
            if (name.includes('music') || name.includes('video') || name.includes('player') || 
                name.includes('media') || name.includes('iina') || name.includes('elmedia') ||
                name.includes('handbrake') || name.includes('freetube') || name.includes('wiliwili') ||
                bundle.includes('music') || bundle.includes('media') || bundle.includes('player')) {
                return 'Media';
            }

            // ç”Ÿäº§åŠ›å·¥å…·
            if (name.includes('notion') || name.includes('obsidian') || name.includes('notes') || 
                name.includes('goodnotes') || name.includes('notability') || name.includes('writer') ||
                name.includes('paste') || name.includes('copy') || name.includes('clipboard') ||
                bundle.includes('notion') || bundle.includes('obsidian') || bundle.includes('notes')) {
                return 'Productivity';
            }

            // ç½‘ç»œå·¥å…·
            if (name.includes('chrome') || name.includes('browser') || name.includes('safari') || 
                name.includes('firefox') || name.includes('edge') || name.includes('chromium') ||
                bundle.includes('chrome') || bundle.includes('browser') || bundle.includes('safari')) {
                return 'Browsers';
            }

            // ç³»ç»Ÿå·¥å…·
            if (name.includes('cleaner') || name.includes('bartender') || name.includes('alttab') || 
                name.includes('istat') || name.includes('monitor') || name.includes('system') ||
                name.includes('settings') || name.includes('control') || name.includes('activity') ||
                bundle.includes('system') || bundle.includes('monitor') || bundle.includes('stat')) {
                return 'Utilities';
            }

            // å®‰å…¨å·¥å…·
            if (name.includes('password') || name.includes('1password') || name.includes('bitwarden') || 
                name.includes('keychain') || name.includes('security') || name.includes('vpn') ||
                name.includes('proxy') || name.includes('firewall') || name.includes('little snitch') ||
                bundle.includes('password') || bundle.includes('security') || bundle.includes('vpn')) {
                return 'Security';
            }

            // å›¾å½¢è®¾è®¡
            if (name.includes('photoshop') || name.includes('illustrator') || name.includes('design') || 
                name.includes('sketch') || name.includes('figma') || name.includes('canva') ||
                bundle.includes('adobe') || bundle.includes('design') || bundle.includes('graphics')) {
                return 'Design';
            }

            // ç½‘ç»œå·¥å…·
            if (name.includes('charles') || name.includes('proxyman') || name.includes('wireshark') || 
                name.includes('network') || name.includes('wifi') || name.includes('sniffnet') ||
                bundle.includes('network') || bundle.includes('proxy') || bundle.includes('charles')) {
                return 'Network';
            }

            // è™šæ‹ŸåŒ–
            if (name.includes('docker') || name.includes('parallels') || name.includes('vmware') || 
                name.includes('utm') || name.includes('virtual') ||
                bundle.includes('docker') || bundle.includes('parallels') || bundle.includes('vmware')) {
                return 'Virtualization';
            }

            // äº‘å­˜å‚¨
            if (name.includes('dropbox') || name.includes('drive') || name.includes('cloud') || 
                name.includes('sync') || name.includes('backup') || name.includes('baidu') ||
                name.includes('å¤¸å…‹') || name.includes('ç½‘ç›˜') ||
                bundle.includes('cloud') || bundle.includes('sync') || bundle.includes('backup')) {
                return 'Cloud Storage';
            }

            // AIå·¥å…·
            if (name.includes('chatgpt') || name.includes('claude') || name.includes('ai') || 
                name.includes('ollama') || name.includes('diffusion') || name.includes('fellou') ||
                bundle.includes('openai') || bundle.includes('anthropic') || bundle.includes('ai')) {
                return 'AI Tools';
            }

            // æ¸¸æˆ
            if (name.includes('game') || name.includes('play') || name.includes('steam') || 
                name.includes('epic') || name.includes('ryujinx') || name.includes('playcover') ||
                bundle.includes('game') || bundle.includes('play') || bundle.includes('steam')) {
                return 'Games';
            }

            // é»˜è®¤è¿”å›Other
            return 'Other';
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const scanInfo = appsData.scan_info;
            const apps = appsData.applications;

            document.getElementById('totalApps').textContent = scanInfo.total_apps;
            
            const categories = [...new Set(apps.map(app => app.category))];
            document.getElementById('totalCategories').textContent = categories.length;
            
            document.getElementById('scanDate').textContent = scanInfo.scan_date.split(' ')[0];
            document.getElementById('systemInfo').textContent = scanInfo.hostname;
        }

        // å¡«å……åˆ†ç±»ç­›é€‰å™¨
        function populateCategoryFilter() {
            const categories = [...new Set(appsData.applications.map(app => app.category))].sort();
            categoryFilter.innerHTML = '<option value="">æ‰€æœ‰åˆ†ç±»</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }

        // æ˜¾ç¤ºåº”ç”¨åˆ—è¡¨
        function displayApps() {
            appsList.innerHTML = '';
            
            filteredApps.forEach(app => {
                const appCard = document.createElement('div');
                appCard.className = 'app-card fade-in';
                
                const categoryColor = getCategoryColor(app.category);
                appCard.style.borderLeftColor = categoryColor;
                
                appCard.innerHTML = `
                    <div class="app-name">${app.name}</div>
                    <div class="app-info">
                        <div><strong>ç‰ˆæœ¬:</strong> ${app.version}</div>
                        <div><strong>å¤§å°:</strong> ${app.size}</div>
                        <div><strong>å®‰è£…æ—¶é—´:</strong> ${app.install_date}</div>
                        <div><strong>Bundle ID:</strong> ${app.bundle_id}</div>
                    </div>
                    <span class="app-category" style="background-color: ${categoryColor}">${app.category}</span>
                `;
                
                appsList.appendChild(appCard);
            });
        }

        // è·å–åˆ†ç±»é¢œè‰²
        function getCategoryColor(category) {
            const colors = {
                'System': '#6c757d',
                'Development': '#28a745',
                'Microsoft': '#007bff',
                'Google': '#fd7e14',
                'Communication': '#17a2b8',
                'Media': '#e83e8c',
                'Productivity': '#20c997',
                'Browsers': '#6f42c1',
                'Utilities': '#ffc107',
                'Security': '#dc3545',
                'Design': '#e74c3c',
                'Network': '#3498db',
                'Virtualization': '#9b59b6',
                'Cloud Storage': '#1abc9c',
                'AI Tools': '#f39c12',
                'Games': '#e91e63',
                'Other': '#95a5a6'
            };
            return colors[category] || colors['Other'];
        }

        // ç­›é€‰å’Œæœç´¢
        function filterApps() {
            const categoryValue = categoryFilter.value;
            const searchValue = searchBox.value.toLowerCase();
            
            filteredApps = appsData.applications.filter(app => {
                const matchesCategory = !categoryValue || app.category === categoryValue;
                const matchesSearch = !searchValue || app.name.toLowerCase().includes(searchValue);
                return matchesCategory && matchesSearch;
            });
            
            displayApps();
            
            // å¦‚æœå½“å‰æ˜¯è¯äº‘è§†å›¾ï¼Œé‡æ–°ç”Ÿæˆè¯äº‘
            if (wordcloudSection.style.display !== 'none') {
                setTimeout(() => {
                    if (isSimpleWordCloud || typeof WordCloud === 'undefined') {
                        generateSimpleWordCloud();
                    } else {
                        generateWordCloud();
                    }
                }, 100);
            }
        }

        // æ˜¾ç¤ºåˆ†ç±»ç»Ÿè®¡
        function displayCategoryStats() {
            const categoryStats = document.getElementById('categoryStats');
            const categories = {};
            
            // ç»Ÿè®¡å„åˆ†ç±»åº”ç”¨æ•°é‡
            appsData.applications.forEach(app => {
                categories[app.category] = (categories[app.category] || 0) + 1;
            });
            
            // æŒ‰æ•°é‡æ’åº
            const sortedCategories = Object.entries(categories)
                .sort((a, b) => b[1] - a[1]);
            
            const maxCount = Math.max(...Object.values(categories));
            
            categoryStats.innerHTML = sortedCategories.map(([category, count]) => {
                const percentage = (count / maxCount) * 100;
                const color = getCategoryColor(category);
                
                return `
                    <div class="category-bar">
                        <div class="category-label">${category}</div>
                        <div class="category-bar-fill" style="background-color: ${color}; width: ${percentage}%;">
                            ${count}
                        </div>
                        <div class="category-count">${count}</div>
                    </div>
                `;
            }).join('');
        }

        // äº‹ä»¶ç›‘å¬å™¨
        categoryFilter.addEventListener('change', filterApps);
        searchBox.addEventListener('input', filterApps);

        // è§†å›¾åˆ‡æ¢
        listViewBtn.addEventListener('click', () => {
            switchView('list');
        });

        cloudViewBtn.addEventListener('click', () => {
            switchView('cloud');
        });

        chartViewBtn.addEventListener('click', () => {
            switchView('chart');
        });

        function switchView(view) {
            // é‡ç½®æ‰€æœ‰æŒ‰é’®çŠ¶æ€
            listViewBtn.classList.remove('active');
            cloudViewBtn.classList.remove('active');
            chartViewBtn.classList.remove('active');
            
            // éšè—æ‰€æœ‰è§†å›¾
            appsList.style.display = 'none';
            wordcloudSection.style.display = 'none';
            categoryChart.style.display = 'none';
            
            if (view === 'list') {
                listViewBtn.classList.add('active');
                appsList.style.display = 'grid';
            } else if (view === 'cloud') {
                cloudViewBtn.classList.add('active');
                wordcloudSection.style.display = 'block';
                
                // å»¶è¿Ÿç”Ÿæˆè¯äº‘ï¼Œç¡®ä¿å®¹å™¨å·²æ˜¾ç¤º
                setTimeout(() => {
                    if (isSimpleWordCloud || typeof WordCloud === 'undefined') {
                        generateSimpleWordCloud();
                    } else {
                        generateWordCloud();
                    }
                }, 100);
            } else if (view === 'chart') {
                chartViewBtn.classList.add('active');
                categoryChart.style.display = 'block';
            }
        }

        // ç”Ÿæˆè¯äº‘
        function generateWordCloud() {
            if (!appsData) return;
            
            const canvas = document.getElementById('wordcloud');
            const container = canvas.parentElement;
            
            // è®¾ç½®canvaså°ºå¯¸ - æ‰©å¤§æ˜¾ç¤ºåŒºåŸŸ
            canvas.width = container.clientWidth - 80; // å‡å»padding
            canvas.height = 700; // å¢åŠ é«˜åº¦
            
            const apps = filteredApps.length > 0 ? filteredApps : appsData.applications;
            
            if (apps.length === 0) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#999';
                ctx.font = '20px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('æ²¡æœ‰æ•°æ®æ˜¾ç¤º', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            // å‡†å¤‡è¯äº‘æ•°æ® - ä½¿ç”¨åº”ç”¨åç§°å’ŒåŸºäºåˆ†ç±»çš„æƒé‡
            const categoryWeights = {
                'Development': 2.0,
                'AI Tools': 1.9,
                'Design': 1.8,
                'Communication': 1.7,
                'Microsoft': 1.6,
                'Productivity': 1.5,
                'Network': 1.4,
                'Google': 1.3,
                'Browsers': 1.2,
                'Virtualization': 1.2,
                'Security': 1.1,
                'Media': 1.1,
                'Cloud Storage': 1.0,
                'Utilities': 0.9,
                'Games': 0.8,
                'System': 0.7,
                'Other': 0.6
            };
            
            const wordData = apps.map(app => {
                const weight = categoryWeights[app.category] || 1.0;
                // æ ¹æ®åº”ç”¨é‡è¦æ€§å’Œåˆ†ç±»è°ƒæ•´å¤§å°
                let baseSize = 20;
                
                // é‡è¦åº”ç”¨åŠ æƒ
                const importantApps = ['Xcode', 'Visual Studio Code', 'Chrome', 'Safari', 'ChatGPT', 'WeChat', 'QQ'];
                if (importantApps.some(important => app.name.includes(important))) {
                    baseSize += 15;
                }
                
                // ç³»ç»Ÿåº”ç”¨é™æƒ
                if (app.category === 'System' && !app.name.includes('Xcode')) {
                    baseSize -= 5;
                }
                
                // æ·»åŠ éšæœºå˜åŒ–
                const randomFactor = Math.random() * 20 + 10;
                const finalSize = Math.floor((baseSize + randomFactor) * weight);
                
                return [app.name, Math.max(finalSize, 12)]; // æœ€å°å­—ä½“å¤§å°12
            });

            // æ¸…é™¤ä¹‹å‰çš„è¯äº‘
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // æ£€æŸ¥WordCloudæ˜¯å¦å¯ç”¨
            if (typeof WordCloud === 'undefined') {
                ctx.fillStyle = '#e74c3c';
                ctx.font = '18px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('è¯äº‘åº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', canvas.width / 2, canvas.height / 2 - 10);
                ctx.fillText('æˆ–ä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬çš„WordCloud.js', canvas.width / 2, canvas.height / 2 + 20);
                return;
            }

            // ç”Ÿæˆè¯äº‘
            try {
                WordCloud(canvas, {
                    list: wordData,
                    gridSize: Math.round(8 * canvas.width / 800),
                    weightFactor: function (size) {
                        return size * canvas.width / 800;
                    },
                    fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                    color: function (word, weight, fontSize, distance, theta) {
                        // æ ¹æ®åº”ç”¨åˆ†ç±»è¿”å›ä¸åŒé¢œè‰²
                        const app = apps.find(a => a.name === word);
                        if (app) {
                            const colors = {
                                'Development': '#28a745',
                                'AI Tools': '#f39c12',
                                'Design': '#e74c3c',
                                'Communication': '#17a2b8',
                                'Microsoft': '#007bff',
                                'Productivity': '#20c997',
                                'Network': '#3498db',
                                'Google': '#fd7e14',
                                'Browsers': '#6f42c1',
                                'Virtualization': '#9b59b6',
                                'Security': '#dc3545',
                                'Media': '#e83e8c',
                                'Cloud Storage': '#1abc9c',
                                'Utilities': '#ffc107',
                                'Games': '#e91e63',
                                'System': '#6c757d',
                                'Other': '#95a5a6'
                            };
                            return colors[app.category] || '#95a5a6';
                        }
                        // å¤‡ç”¨é¢œè‰²
                        const fallbackColors = ['#007bff', '#28a745', '#dc3545', '#fd7e14', '#6f42c1', '#e83e8c'];
                        return fallbackColors[Math.floor(Math.random() * fallbackColors.length)];
                    },
                    rotateRatio: 0.3,
                    rotationSteps: 2,
                    backgroundColor: 'transparent',
                    minSize: 12,
                    maxRotation: Math.PI / 6,
                    minRotation: -Math.PI / 6,
                    shuffle: true,
                    drawOutOfBound: false,
                    shrinkToFit: true
                });
                
                // è¯äº‘ç”ŸæˆæˆåŠŸåæ˜¾ç¤ºä¿å­˜æŒ‰é’®
                document.getElementById('saveWordCloudBtn').style.display = 'block';
            } catch (error) {
                console.error('è¯äº‘ç”Ÿæˆé”™è¯¯:', error);
                ctx.fillStyle = '#e74c3c';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('è¯äº‘ç”Ÿæˆå¤±è´¥: ' + error.message, canvas.width / 2, canvas.height / 2);
            }
        }

        // åˆå§‹åŒ–æ—¶è°ƒæ•´canvaså¤§å°
        window.addEventListener('resize', () => {
            if (wordcloudSection.style.display !== 'none') {
                setTimeout(generateWordCloud, 100);
            }
        });

        // å¤‡ç”¨è¯äº‘å®ç°ï¼ˆç®€å•ç‰ˆæœ¬ï¼‰
        function generateSimpleWordCloud() {
            const canvas = document.getElementById('wordcloud');
            const container = canvas.parentElement;
            const ctx = canvas.getContext('2d');
            
            // è®¾ç½®canvaså°ºå¯¸ - æ‰©å¤§æ˜¾ç¤ºåŒºåŸŸ
            canvas.width = container.clientWidth - 80;
            canvas.height = 700; // å¢åŠ é«˜åº¦
            
            const apps = filteredApps.length > 0 ? filteredApps : appsData.applications;
            
            if (apps.length === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#999';
                ctx.font = '20px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('æ²¡æœ‰æ•°æ®æ˜¾ç¤º', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç®€å•çš„ç½‘æ ¼å¸ƒå±€
            const cols = Math.ceil(Math.sqrt(apps.length));
            const rows = Math.ceil(apps.length / cols);
            const cellWidth = canvas.width / cols;
            const cellHeight = canvas.height / rows;
            
            apps.forEach((app, index) => {
                const col = index % cols;
                const row = Math.floor(index / cols);
                const x = col * cellWidth + cellWidth / 2;
                const y = row * cellHeight + cellHeight / 2;
                
                // æ ¹æ®åˆ†ç±»è®¾ç½®é¢œè‰²å’Œå¤§å°
                const categoryColors = {
                    'Development': '#28a745',
                    'AI Tools': '#f39c12',
                    'Design': '#e74c3c',
                    'Communication': '#17a2b8',
                    'Microsoft': '#007bff',
                    'Productivity': '#20c997',
                    'Network': '#3498db',
                    'Google': '#fd7e14',
                    'Browsers': '#6f42c1',
                    'Virtualization': '#9b59b6',
                    'Security': '#dc3545',
                    'Media': '#e83e8c',
                    'Cloud Storage': '#1abc9c',
                    'Utilities': '#ffc107',
                    'Games': '#e91e63',
                    'System': '#6c757d',
                    'Other': '#95a5a6'
                };
                
                const categorySizes = {
                    'Development': 20,
                    'AI Tools': 19,
                    'Design': 18,
                    'Communication': 17,
                    'Microsoft': 16,
                    'Productivity': 15,
                    'Network': 14,
                    'Google': 14,
                    'Browsers': 13,
                    'Virtualization': 13,
                    'Security': 12,
                    'Media': 12,
                    'Cloud Storage': 11,
                    'Utilities': 11,
                    'Games': 10,
                    'System': 10,
                    'Other': 9
                };
                
                ctx.fillStyle = categoryColors[app.category] || '#667eea';
                ctx.font = `${categorySizes[app.category] || 12}px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // æ–‡å­—å¤ªé•¿æ—¶æˆªæ–­
                let displayName = app.name;
                if (displayName.length > 15) {
                    displayName = displayName.substring(0, 12) + '...';
                }
                
                ctx.fillText(displayName, x, y);
            });

            // æ˜¾ç¤ºä¿å­˜æŒ‰é’®
            document.getElementById('saveWordCloudBtn').style.display = 'block';
        }

        // è¯äº‘ç±»å‹åˆ‡æ¢
        let isSimpleWordCloud = false;
        
        function toggleWordCloudType() {
            isSimpleWordCloud = !isSimpleWordCloud;
            const toggleBtn = document.getElementById('wordcloudToggle');
            
            if (isSimpleWordCloud) {
                toggleBtn.textContent = 'é«˜çº§è¯äº‘';
                generateSimpleWordCloud();
            } else {
                toggleBtn.textContent = 'ç®€å•å¸ƒå±€';
                generateWordCloud();
            }
        }

        // æ£€æµ‹WordCloudåº“æ˜¯å¦åŠ è½½æˆåŠŸ
        function checkWordCloudLibrary() {
            if (typeof WordCloud === 'undefined') {
                console.warn('WordCloudåº“æœªåŠ è½½ï¼Œä½¿ç”¨ç®€å•è¯äº‘');
                isSimpleWordCloud = true;
                const toggleBtn = document.getElementById('wordcloudToggle');
                if (toggleBtn) {
                    toggleBtn.style.display = 'none';
                }
                return false;
            }
            return true;
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥åº“
        window.addEventListener('load', () => {
            setTimeout(checkWordCloudLibrary, 1000);
            createParticles();
        });

        // ä¸‹è½½æ‰«æè„šæœ¬
        function downloadScanScript() {
            const scriptContent = `#!/bin/bash

# Mac App Scanner - æ‰«æMacä¸Šå®‰è£…çš„è½¯ä»¶
# Author: xiebaiyuan
# Date: 2025å¹´8æœˆ13æ—¥

# è®¾ç½®è¾“å‡ºæ–‡ä»¶
OUTPUT_FILE="$(dirname "$0")/apps_data.json"
TEMP_FILE="/tmp/mac_apps_temp.txt"

echo "ğŸ” å¼€å§‹æ‰«æMacä¸Šå®‰è£…çš„è½¯ä»¶..."

# è·å–ç³»ç»Ÿä¿¡æ¯
SCAN_DATE=$(date "+%Y-%m-%d %H:%M:%S")
HOSTNAME=$(hostname)
USERNAME=$(whoami)

echo "ğŸ“± æ‰«æApplicationsæ–‡ä»¶å¤¹..."

# åˆå§‹åŒ–åº”ç”¨è®¡æ•°
APP_COUNT=0

# ä¸´æ—¶å­˜å‚¨åº”ç”¨ä¿¡æ¯
echo "[" > "$TEMP_FILE"

# æ‰«æ/Applicationsç›®å½•
for app in /Applications/*.app; do
    if [ -d "$app" ]; then
        APP_NAME=$(basename "$app" .app)
        
        # è·å–åº”ç”¨ä¿¡æ¯
        INFO_PLIST="$app/Contents/Info.plist"
        
        if [ -f "$INFO_PLIST" ]; then
            # è·å–ç‰ˆæœ¬ä¿¡æ¯
            VERSION=$(/usr/libexec/PlistBuddy -c "Print :CFBundleShortVersionString" "$INFO_PLIST" 2>/dev/null || echo "Unknown")
            BUNDLE_ID=$(/usr/libexec/PlistBuddy -c "Print :CFBundleIdentifier" "$INFO_PLIST" 2>/dev/null || echo "Unknown")
            
            # è·å–æ–‡ä»¶å¤§å°
            SIZE=$(du -sh "$app" 2>/dev/null | cut -f1 || echo "Unknown")
            
            # è·å–åˆ›å»ºæ—¶é—´
            INSTALL_DATE=$(stat -f "%Sm" -t "%Y-%m-%d %H:%M:%S" "$app" 2>/dev/null || echo "Unknown")
            
            # ç”Ÿæˆåº”ç”¨åˆ†ç±»ï¼ˆåŸºäºBundle IDçš„ç®€å•åˆ†ç±»ï¼‰
            CATEGORY="Other"
            case "$BUNDLE_ID" in
                com.apple.*) CATEGORY="System" ;;
                com.microsoft.*) CATEGORY="Microsoft" ;;
                com.adobe.*) CATEGORY="Adobe" ;;
                com.google.*) CATEGORY="Google" ;;
                *developer*|*xcode*|*git*) CATEGORY="Development" ;;
                *game*|*Games*) CATEGORY="Games" ;;
                *music*|*audio*|*video*|*media*) CATEGORY="Media" ;;
                *productivity*|*office*) CATEGORY="Productivity" ;;
                *utility*|*Utility*) CATEGORY="Utilities" ;;
            esac
            
            # æ·»åŠ é€—å·ï¼ˆé™¤äº†ç¬¬ä¸€ä¸ªåº”ç”¨ï¼‰
            if [ $APP_COUNT -gt 0 ]; then
                echo "," >> "$TEMP_FILE"
            fi
            
            # è½¬ä¹‰JSONå­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦
            APP_NAME_CLEAN=$(echo "$APP_NAME" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            VERSION_CLEAN=$(echo "$VERSION" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            BUNDLE_ID_CLEAN=$(echo "$BUNDLE_ID" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            SIZE_CLEAN=$(echo "$SIZE" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            INSTALL_DATE_CLEAN=$(echo "$INSTALL_DATE" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            PATH_CLEAN=$(echo "$app" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            
            # å†™å…¥JSONæ ¼å¼çš„åº”ç”¨ä¿¡æ¯
            echo "    {" >> "$TEMP_FILE"
            echo "      \\"name\\": \\"$APP_NAME_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"version\\": \\"$VERSION_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"bundle_id\\": \\"$BUNDLE_ID_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"size\\": \\"$SIZE_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"install_date\\": \\"$INSTALL_DATE_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"category\\": \\"$CATEGORY\\"," >> "$TEMP_FILE"
            echo "      \\"path\\": \\"$PATH_CLEAN\\"" >> "$TEMP_FILE"
            echo -n "    }" >> "$TEMP_FILE"
            
            APP_COUNT=$((APP_COUNT + 1))
            echo "  âœ… å‘ç°: $APP_NAME ($VERSION)"
        fi
    fi
done

# æ‰«æ/System/Applicationsç›®å½•ï¼ˆç³»ç»Ÿåº”ç”¨ï¼‰
echo "ğŸ–¥ï¸  æ‰«æç³»ç»Ÿåº”ç”¨..."
for app in /System/Applications/*.app; do
    if [ -d "$app" ]; then
        APP_NAME=$(basename "$app" .app)
        
        INFO_PLIST="$app/Contents/Info.plist"
        
        if [ -f "$INFO_PLIST" ]; then
            VERSION=$(/usr/libexec/PlistBuddy -c "Print :CFBundleShortVersionString" "$INFO_PLIST" 2>/dev/null || echo "System")
            BUNDLE_ID=$(/usr/libexec/PlistBuddy -c "Print :CFBundleIdentifier" "$INFO_PLIST" 2>/dev/null || echo "Unknown")
            SIZE=$(du -sh "$app" 2>/dev/null | cut -f1 || echo "Unknown")
            INSTALL_DATE=$(stat -f "%Sm" -t "%Y-%m-%d %H:%M:%S" "$app" 2>/dev/null || echo "Unknown")
            
            if [ $APP_COUNT -gt 0 ]; then
                echo "," >> "$TEMP_FILE"
            fi
            
            # è½¬ä¹‰JSONå­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦
            APP_NAME_CLEAN=$(echo "$APP_NAME" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            VERSION_CLEAN=$(echo "$VERSION" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            BUNDLE_ID_CLEAN=$(echo "$BUNDLE_ID" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            SIZE_CLEAN=$(echo "$SIZE" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            INSTALL_DATE_CLEAN=$(echo "$INSTALL_DATE" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            PATH_CLEAN=$(echo "$app" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            
            # å†™å…¥JSONæ ¼å¼çš„åº”ç”¨ä¿¡æ¯
            echo "    {" >> "$TEMP_FILE"
            echo "      \\"name\\": \\"$APP_NAME_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"version\\": \\"$VERSION_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"bundle_id\\": \\"$BUNDLE_ID_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"size\\": \\"$SIZE_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"install_date\\": \\"$INSTALL_DATE_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"category\\": \\"System\\"," >> "$TEMP_FILE"
            echo "      \\"path\\": \\"$PATH_CLEAN\\"" >> "$TEMP_FILE"
            echo -n "    }" >> "$TEMP_FILE"
            
            APP_COUNT=$((APP_COUNT + 1))
            echo "  âœ… å‘ç°ç³»ç»Ÿåº”ç”¨: $APP_NAME"
        fi
    fi
done

# å®Œæˆä¸´æ—¶æ–‡ä»¶
echo "" >> "$TEMP_FILE"
echo "]" >> "$TEMP_FILE"

# åˆ›å»ºæœ€ç»ˆçš„JSONæ–‡ä»¶
cat > "$OUTPUT_FILE" << EOF
{
  "scan_info": {
    "scan_date": "$SCAN_DATE",
    "hostname": "$HOSTNAME",
    "username": "$USERNAME",
    "total_apps": $APP_COUNT
  },
  "applications": 
EOF

# è¿½åŠ åº”ç”¨æ•°æ®
cat "$TEMP_FILE" >> "$OUTPUT_FILE"

# å®ŒæˆJSONæ–‡ä»¶
echo "}" >> "$OUTPUT_FILE"

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -f "$TEMP_FILE"

echo ""
echo "ğŸ‰ æ‰«æå®Œæˆï¼"
echo "ğŸ“Š æ€»å…±å‘ç° $APP_COUNT ä¸ªåº”ç”¨"
echo "ğŸ“„ ç»“æœä¿å­˜åˆ°: $OUTPUT_FILE"
echo ""
echo "ğŸŒ ç°åœ¨å¯ä»¥æ‰“å¼€ç½‘é¡µå¹¶æ‹–å…¥ apps_data.json æ–‡ä»¶æŸ¥çœ‹ç»“æœ"

# æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰“å¼€ç½‘é¡µ
read -p "æ˜¯å¦è¦åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ç»“æœé¡µé¢ï¼Ÿ(y/n): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    if [ -f "$(dirname "$0")/index.html" ]; then
        open "$(dirname "$0")/index.html"
    else
        echo "âŒ æœªæ‰¾åˆ° index.html æ–‡ä»¶"
    fi
fi
`;

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([scriptContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'scan_apps.sh';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

        // æ˜¾ç¤ºä¸‹è½½æˆåŠŸæç¤º
            showNotification('ğŸ“¥ æ‰«æè„šæœ¬ä¸‹è½½æˆåŠŸï¼è¯·åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼šchmod +x scan_apps.sh && ./scan_apps.sh', 'success');
        }

        // ä¿å­˜è¯äº‘å›¾ç‰‡
        function saveWordCloudImage() {
            const canvas = document.getElementById('wordcloud');
            
            if (!canvas) {
                showNotification('âŒ æœªæ‰¾åˆ°è¯äº‘ç”»å¸ƒ', 'error');
                return;
            }

            try {
                // åˆ›å»ºä¸€ä¸ªæ–°çš„canvasç”¨äºé«˜è´¨é‡å¯¼å‡º
                const exportCanvas = document.createElement('canvas');
                const exportCtx = exportCanvas.getContext('2d');
                
                // è®¾ç½®æ›´é«˜çš„åˆ†è¾¨ç‡
                const scale = 2; // 2å€åˆ†è¾¨ç‡
                exportCanvas.width = canvas.width * scale;
                exportCanvas.height = canvas.height * scale;
                
                // è®¾ç½®ç™½è‰²èƒŒæ™¯
                exportCtx.fillStyle = '#ffffff';
                exportCtx.fillRect(0, 0, exportCanvas.width, exportCanvas.height);
                
                // ç¼©æ”¾å¹¶ç»˜åˆ¶åŸå§‹canvaså†…å®¹
                exportCtx.scale(scale, scale);
                exportCtx.drawImage(canvas, 0, 0);
                
                // ç”Ÿæˆæ–‡ä»¶å
                const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
                const filename = `mac-apps-wordcloud-${timestamp}.png`;
                
                // è½¬æ¢ä¸ºblobå¹¶ä¸‹è½½
                exportCanvas.toBlob(function(blob) {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    showNotification(`ğŸ’¾ è¯äº‘å›¾ç‰‡å·²ä¿å­˜ä¸º: ${filename}`, 'success');
                }, 'image/png', 1.0);
                
            } catch (error) {
                console.error('ä¿å­˜å›¾ç‰‡å¤±è´¥:', error);
                showNotification('âŒ ä¿å­˜å›¾ç‰‡å¤±è´¥: ' + error.message, 'error');
            }
        }

        // é‡æ–°ç”Ÿæˆè¯äº‘
        function regenerateWordCloud() {
            if (wordcloudSection.style.display !== 'none') {
                setTimeout(() => {
                    if (isSimpleWordCloud || typeof WordCloud === 'undefined') {
                        generateSimpleWordCloud();
                    } else {
                        generateWordCloud();
                    }
                }, 100);
                
                showNotification('ğŸ”„ è¯äº‘å·²é‡æ–°ç”Ÿæˆ', 'info');
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: 'rgba(40, 167, 69, 0.95)',
                error: 'rgba(220, 53, 69, 0.95)',
                info: 'rgba(23, 162, 184, 0.95)',
                warning: 'rgba(255, 193, 7, 0.95)'
            };
            
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: ${colors[type] || colors.info}; color: white; padding: 15px 20px; border-radius: 10px; z-index: 1000; backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,0.2); max-width: 400px; word-break: break-word;">
                    ${message}
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // åˆ›å»ºèƒŒæ™¯ç²’å­æ•ˆæœ
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                createSingleParticle(particlesContainer, i * 1000);
            }
        }

        function createSingleParticle(container, delay = 0) {
            setTimeout(() => {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // éšæœºå¤§å°
                const size = Math.random() * 6 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                // éšæœºä½ç½®
                particle.style.left = Math.random() * 100 + '%';
                
                // éšæœºåŠ¨ç”»æ—¶é•¿
                const duration = Math.random() * 15 + 15;
                particle.style.animationDuration = duration + 's';
                
                container.appendChild(particle);
                
                // ç²’å­åŠ¨ç”»ç»“æŸåé‡æ–°åˆ›å»º
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.remove();
                    }
                    createSingleParticle(container);
                }, duration * 1000);
                
            }, delay);
        }
    </script>
</body>
</html>
