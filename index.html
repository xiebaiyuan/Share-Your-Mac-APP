<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mac应用扫描器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #00b894 100%);
            background-attachment: fixed;
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* 背景粒子效果 */
        .background-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
            transform: translateY(-100px) rotate(360deg);
            opacity: 0;
        }
    }

    /* Footer样式 */
    footer a {
        transition: all 0.3s ease;
    }

    footer a:hover {
        color: rgba(255, 255, 255, 1) !important;
        transform: translateY(-2px);
    }        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #2c3e50;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            color: #6c757d;
        }

        /* 导入区域样式 */
        .drop-zone {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 60px 40px;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            transition: all 0.3s ease;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .drop-zone.dragover {
            border-color: #007bff;
            background: rgba(0, 123, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .drop-zone h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .drop-zone p {
            color: #6c757d;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .file-input {
            display: none;
        }

        .file-input-btn {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .file-input-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .file-input-btn.demo-btn {
            background: #28a745;
            margin-left: 15px;
        }

        .file-input-btn.demo-btn:hover {
            background: #218838;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        /* 结果显示区域 */
        .results-container {
            display: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #007bff;
            display: block;
        }

        .stat-label {
            font-size: 1.1rem;
            color: #666;
            margin-top: 10px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 500;
            color: #333;
        }

        select, input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .view-toggle {
            margin-left: auto;
        }

        .toggle-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 5px;
            font-weight: 500;
        }

        .toggle-btn.active {
            background: #007bff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }

        .toggle-btn:hover:not(.active) {
            background: #5a6268;
        }

        /* 应用列表样式 */
        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .app-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 4px solid #007bff;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .app-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .app-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .app-info {
            display: grid;
            gap: 5px;
            font-size: 0.9rem;
            color: #666;
        }

        .app-category {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-top: 10px;
            font-weight: 500;
        }

        /* 词云容器 */
        .wordcloud-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 30px;
            position: relative;
            min-height: 600px;
        }

        /* 分类统计条形图 */
        .category-bar {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            border-radius: 8px;
            background: rgba(0,0,0,0.02);
        }

        .category-label {
            width: 120px;
            text-align: left;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .category-bar-fill {
            height: 20px;
            border-radius: 10px;
            margin: 0 10px;
            flex: 1;
            max-width: 300px;
            position: relative;
            display: flex;
            align-items: center;
            padding: 0 8px;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .category-count {
            width: 40px;
            text-align: right;
            font-weight: bold;
            color: #333;
        }

        #wordcloud {
            width: 100%;
            height: 800px;
            margin: 20px 0;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            max-width: 100%;
        }
        
        /* 保存按钮样式 */
        .save-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .save-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .save-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* 下载按钮样式 - 统一按钮风格 */
        .download-script-btn {
            background: #20c997;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            margin-left: 15px;
        }
        
        .download-script-btn:hover {
            background: #1ea085;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(32, 201, 151, 0.3);
        }

        /* 安全提示样式 */
        .security-notice {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(32, 201, 151, 0.1) 100%);
            border: 2px solid rgba(40, 167, 69, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .security-notice h3 {
            color: #28a745;
            margin: 0 0 10px 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .security-notice p {
            margin: 8px 0;
            color: #333;
            line-height: 1.5;
        }

        .security-notice .highlight {
            background: rgba(40, 167, 69, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }

        /* 动画效果 */
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading {
            text-align: center;
            color: #6c757d;
            font-size: 1.2rem;
            margin: 40px 0;
        }

        .loading::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .view-toggle {
                margin-left: 0;
                margin-top: 10px;
            }
            
            .apps-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <!-- 引入WordCloud.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js"></script>
    
    <!-- GitHub Pages 支持 -->
    <script>
        // 检测是否在GitHub Pages环境
        const isGitHubPages = window.location.hostname.includes('github.io');
        const basePath = isGitHubPages ? '/Share-Your-Mac-APP' : '';
        
        // 设置基础路径用于资源加载
        if (isGitHubPages) {
            console.log('运行在 GitHub Pages 环境');
        }
    </script>
</head>
<body>
    <!-- 背景粒子效果 -->
    <div class="background-particles" id="particles"></div>
    
    <div class="container">
        <div class="header">
            <h1>🍎 Mac应用扫描器</h1>
            <p>扫描并展示你的Mac上安装的所有应用程序</p>
            <div style="margin-top: 15px; padding: 15px; background: rgba(0,123,255,0.1); border-radius: 10px; font-size: 0.9rem;">
                ✨ <strong>新功能:</strong> 智能分类系统、美化界面设计、多视图展示
            </div>
        </div>

        <!-- 文件导入区域 -->
        <div id="import-section">
            <div class="drop-zone" id="dropZone">
                <h2>📱 导入扫描结果</h2>
                <p>将 apps_data.json 文件拖拽到这里，或点击下方按钮选择文件</p>
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" class="file-input" accept=".json">
                    <button class="file-input-btn" onclick="document.getElementById('fileInput').click()">
                        选择文件
                    </button>
                    <button class="file-input-btn demo-btn" onclick="loadDemo()">
                        🎮 加载演示数据
                    </button>
                    <button class="download-script-btn" onclick="downloadScanScript()">
                        📥 下载扫描脚本
                    </button>
                </div>
                
                <!-- 安全提示 -->
                <div class="security-notice">
                    <h3>🛡️ 安全保证</h3>
                    <p>• <span class="highlight">完全安全</span>：脚本只读取应用信息，不会修改或删除任何文件</p>
                    <p>• <span class="highlight">无需担心</span>：所有数据都在本地处理，不会上传到任何服务器</p>
                    <p>• <span class="highlight">开源透明</span>：您可以查看脚本源代码，确保安全可靠</p>
                    <p>• <span class="highlight">简单易用</span>：下载脚本后在终端中运行，生成的文件直接拖到网页即可</p>
                </div>
                
                <p style="margin-top: 20px; font-size: 0.9rem;">
                    💡 使用步骤：<span class="highlight">下载脚本</span> → <span class="highlight">终端运行 chmod +x scan_apps.sh && ./scan_apps.sh</span> → <span class="highlight">拖拽生成的文件到网页</span>，或点击"加载演示数据"体验功能
                </p>
            </div>
        </div>

        <!-- 结果显示区域 -->
        <div id="results-section" class="results-container">
            <!-- 统计信息 -->
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="totalApps">0</span>
                    <div class="stat-label">总应用数</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="totalCategories">0</span>
                    <div class="stat-label">应用分类</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="scanDate">-</span>
                    <div class="stat-label">扫描时间</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="systemInfo">-</span>
                    <div class="stat-label">系统信息</div>
                </div>
            </div>

            <!-- 控制面板 -->
            <div class="controls">
                <div class="control-group">
                    <label for="categoryFilter">分类筛选:</label>
                    <select id="categoryFilter">
                        <option value="">所有分类</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="searchBox">搜索:</label>
                    <input type="text" id="searchBox" placeholder="输入应用名称...">
                </div>
                <div class="view-toggle">
                    <button class="toggle-btn active" id="listViewBtn">📋 列表视图</button>
                    <button class="toggle-btn" id="cloudViewBtn">☁️ 词云视图</button>
                    <button class="toggle-btn" id="chartViewBtn">📊 统计视图</button>
                </div>
            </div>

            <!-- 应用列表 -->
            <div id="apps-list" class="apps-grid"></div>

            <!-- 词云视图 -->
            <div id="wordcloud-section" class="wordcloud-container">
                <button id="saveWordCloudBtn" class="save-button" onclick="saveWordCloudImage()" style="display: none;">
                    💾 保存图片
                </button>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>📊 应用词云</h2>
                    <div>
                        <button id="wordcloudToggle" class="toggle-btn" onclick="toggleWordCloudType()">
                            切换样式
                        </button>
                        <button id="regenerateBtn" class="toggle-btn" onclick="regenerateWordCloud()" style="background: #17a2b8;">
                            🔄 重新生成
                        </button>
                    </div>
                </div>
                <p>根据应用名称和分类生成的可视化词云</p>
                <canvas id="wordcloud"></canvas>
                <div style="margin-top: 20px; font-size: 0.9rem; color: #666;">
                    💡 不同颜色代表不同应用分类，字体大小反映应用重要性<br>
                    📸 生成词云后可点击右上角"保存图片"按钮下载高清图片<br>
                    🎨 支持多种显示样式，可点击"切换样式"或"重新生成"获得不同效果
                </div>
            </div>

            <!-- 分类统计图表 -->
            <div id="category-chart" class="wordcloud-container">
                <h2>📈 分类统计</h2>
                <p>展示各个应用分类的数量分布</p>
                <div id="categoryStats" style="margin: 20px 0;"></div>
            </div>
        </div>
    </div>

    <!-- 底部版权信息 -->
    <footer style="text-align: center; padding: 40px 20px; margin-top: 60px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-top: 1px solid rgba(255, 255, 255, 0.2);">
        <div style="max-width: 800px; margin: 0 auto;">
            <p style="margin: 0 0 10px 0; font-size: 1.1rem; font-weight: 500; color: rgba(255, 255, 255, 0.9);">
                🍎 Mac应用扫描器
            </p>
            <p style="margin: 0 0 15px 0; font-size: 0.9rem; color: rgba(255, 255, 255, 0.7);">
                一个简单而强大的Mac应用程序扫描与可视化工具
            </p>
            <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-bottom: 20px;">
                <a href="https://github.com/xiebaiyuan/Share-Your-Mac-APP" target="_blank" 
                   style="color: rgba(255, 255, 255, 0.8); text-decoration: none; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; transition: color 0.3s ease;">
                    <span>📂</span> GitHub 仓库
                </a>
                <span style="color: rgba(255, 255, 255, 0.5);">|</span>
                <span style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                    👨‍💻 作者: <a href="https://github.com/xiebaiyuan" target="_blank" style="color: rgba(255, 255, 255, 0.8); text-decoration: none;">xiebaiyuan</a>
                </span>
            </div>
            <p style="margin: 0; font-size: 0.8rem; color: rgba(255, 255, 255, 0.6);">
                © 2025 Share-Your-Mac-APP. 基于 MIT 许可证开源
            </p>
        </div>
    </footer>

    <script>
        let appsData = null;
        let filteredApps = [];

        // Demo数据 - 基于您的实际应用数据的精选样本
        const demoData = {
            "scan_info": {
                "scan_date": "2025-08-12 19:51:50",
                "hostname": "Demo-MacBook-Pro",
                "username": "demo_user",
                "total_apps": 45
            },
            "applications": [
                {
                    "name": "Visual Studio Code",
                    "version": "1.103.0",
                    "bundle_id": "com.microsoft.VSCode",
                    "size": "400M",
                    "install_date": "2025-07-25 20:41:14",
                    "category": "Development",
                    "path": "/Applications/Visual Studio Code.app"
                },
                {
                    "name": "Xcode",
                    "version": "16.0",
                    "bundle_id": "com.apple.dt.Xcode",
                    "size": "4.8G",
                    "install_date": "2024-09-24 16:30:52",
                    "category": "Development",
                    "path": "/Applications/Xcode.app"
                },
                {
                    "name": "ChatGPT",
                    "version": "1.2025.217",
                    "bundle_id": "com.openai.chat",
                    "size": "108M",
                    "install_date": "2025-08-12 11:35:46",
                    "category": "AI Tools",
                    "path": "/Applications/ChatGPT.app"
                },
                {
                    "name": "Claude",
                    "version": "0.9.3",
                    "bundle_id": "com.anthropic.claudefordesktop",
                    "size": "266M",
                    "install_date": "2025-04-30 23:49:11",
                    "category": "AI Tools",
                    "path": "/Applications/Claude.app"
                },
                {
                    "name": "Google Chrome",
                    "version": "137.0.7151.69",
                    "bundle_id": "com.google.Chrome",
                    "size": "1.8G",
                    "install_date": "2024-05-17 02:38:04",
                    "category": "Browsers",
                    "path": "/Applications/Google Chrome.app"
                },
                {
                    "name": "Safari",
                    "version": "18.4",
                    "bundle_id": "com.apple.Safari",
                    "size": "0B",
                    "install_date": "2025-03-27 19:00:33",
                    "category": "Browsers",
                    "path": "/Applications/Safari.app"
                },
                {
                    "name": "WeChat",
                    "version": "4.0.6",
                    "bundle_id": "com.tencent.xinWeChat",
                    "size": "1.0G",
                    "install_date": "2025-07-23 14:12:11",
                    "category": "Communication",
                    "path": "/Applications/WeChat.app"
                },
                {
                    "name": "Telegram",
                    "version": "11.15",
                    "bundle_id": "ru.keepcoder.Telegram",
                    "size": "298M",
                    "install_date": "2025-08-04 10:24:18",
                    "category": "Communication",
                    "path": "/Applications/Telegram.app"
                },
                {
                    "name": "Discord",
                    "version": "0.0.355",
                    "bundle_id": "com.hnc.Discord",
                    "size": "431M",
                    "install_date": "2025-07-28 10:28:46",
                    "category": "Communication",
                    "path": "/Applications/Discord.app"
                },
                {
                    "name": "Notion",
                    "version": "4.17.0",
                    "bundle_id": "notion.id",
                    "size": "255M",
                    "install_date": "2025-08-06 22:23:32",
                    "category": "Productivity",
                    "path": "/Applications/Notion.app"
                },
                {
                    "name": "Obsidian",
                    "version": "1.7.7",
                    "bundle_id": "md.obsidian",
                    "size": "271M",
                    "install_date": "2024-11-17 09:49:33",
                    "category": "Productivity",
                    "path": "/Applications/Obsidian.app"
                },
                {
                    "name": "1Password",
                    "version": "8.11.4",
                    "bundle_id": "com.1password.1password",
                    "size": "430M",
                    "install_date": "2025-08-06 12:04:53",
                    "category": "Security",
                    "path": "/Applications/1Password.app"
                },
                {
                    "name": "Docker",
                    "version": "4.40.0",
                    "bundle_id": "com.docker.docker",
                    "size": "1.8G",
                    "install_date": "2025-03-29 22:28:19",
                    "category": "Virtualization",
                    "path": "/Applications/Docker.app"
                },
                {
                    "name": "IINA",
                    "version": "1.3.5",
                    "bundle_id": "com.colliderli.iina",
                    "size": "159M",
                    "install_date": "2024-05-31 09:19:32",
                    "category": "Media",
                    "path": "/Applications/IINA.app"
                },
                {
                    "name": "Raycast",
                    "version": "1.102.3",
                    "bundle_id": "com.raycast.macos",
                    "size": "122M",
                    "install_date": "2025-07-31 20:08:28",
                    "category": "Utilities",
                    "path": "/Applications/Raycast.app"
                },
                {
                    "name": "Microsoft Excel",
                    "version": "16.73",
                    "bundle_id": "com.microsoft.Excel",
                    "size": "2.0G",
                    "install_date": "2023-05-29 16:06:12",
                    "category": "Microsoft",
                    "path": "/Applications/Microsoft Excel.app"
                },
                {
                    "name": "Microsoft Word",
                    "version": "16.73",
                    "bundle_id": "com.microsoft.Word",
                    "size": "2.3G",
                    "install_date": "2023-05-29 16:06:12",
                    "category": "Microsoft",
                    "path": "/Applications/Microsoft Word.app"
                },
                {
                    "name": "Parallels Desktop",
                    "version": "20.1.3",
                    "bundle_id": "com.parallels.desktop.console",
                    "size": "381M",
                    "install_date": "2024-12-17 06:17:05",
                    "category": "Virtualization",
                    "path": "/Applications/Parallels Desktop.app"
                },
                {
                    "name": "Photoshop",
                    "version": "25.0.0",
                    "bundle_id": "com.adobe.Photoshop",
                    "size": "3.2G",
                    "install_date": "2024-08-15 14:30:20",
                    "category": "Design",
                    "path": "/Applications/Adobe Photoshop 2024/Adobe Photoshop 2024.app"
                },
                {
                    "name": "Finder",
                    "version": "12.7",
                    "bundle_id": "com.apple.finder",
                    "size": "8.5M",
                    "install_date": "2025-03-27 19:00:33",
                    "category": "System",
                    "path": "/System/Library/CoreServices/Finder.app"
                }
            ]
        };

        // 加载Demo数据
        function loadDemo() {
            appsData = JSON.parse(JSON.stringify(demoData)); // 深拷贝
            displayResults();
            
            // 显示Demo提示
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.innerHTML = `
                    <div style="position: fixed; top: 20px; right: 20px; background: rgba(40, 167, 69, 0.95); color: white; padding: 15px 20px; border-radius: 10px; z-index: 1000; backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
                        ✅ Demo数据加载成功！您可以体验各种功能
                    </div>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }, 500);
        }

        // DOM元素
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const importSection = document.getElementById('import-section');
        const resultsSection = document.getElementById('results-section');
        const categoryFilter = document.getElementById('categoryFilter');
        const searchBox = document.getElementById('searchBox');
        const listViewBtn = document.getElementById('listViewBtn');
        const cloudViewBtn = document.getElementById('cloudViewBtn');
        const chartViewBtn = document.getElementById('chartViewBtn');
        const appsList = document.getElementById('apps-list');
        const wordcloudSection = document.getElementById('wordcloud-section');
        const categoryChart = document.getElementById('category-chart');

        // 文件拖拽处理
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // 处理文件
        function handleFile(file) {
            if (!file.name.endsWith('.json')) {
                alert('请选择JSON文件！');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    appsData = JSON.parse(e.target.result);
                    displayResults();
                } catch (error) {
                    alert('文件格式错误，请确保是有效的JSON文件！');
                    console.error('解析错误:', error);
                }
            };
            reader.readAsText(file);
        }

        // 显示结果
        function displayResults() {
            // 隐藏导入区域，显示结果区域
            importSection.style.display = 'none';
            resultsSection.style.display = 'block';
            resultsSection.classList.add('fade-in');

            // 重新分类应用
            reclassifyApps();

            // 更新统计信息
            updateStats();
            
            // 填充分类筛选器
            populateCategoryFilter();
            
            // 显示应用列表
            filteredApps = appsData.applications;
            displayApps();
            
            // 显示分类统计
            displayCategoryStats();
        }

        // 重新分类应用，减少Other分类
        function reclassifyApps() {
            appsData.applications.forEach(app => {
                if (app.category === 'Other') {
                    app.category = getImprovedCategory(app.name, app.bundle_id);
                }
            });
        }

        // 改进的分类逻辑
        function getImprovedCategory(appName, bundleId) {
            const name = appName.toLowerCase();
            const bundle = bundleId ? bundleId.toLowerCase() : '';

            // 开发工具
            if (name.includes('xcode') || name.includes('code') || name.includes('developer') || 
                name.includes('cursor') || name.includes('sublime') || name.includes('jetbrains') ||
                name.includes('deveco') || name.includes('android') || name.includes('studio') ||
                bundle.includes('developer') || bundle.includes('deveco') || bundle.includes('xcode')) {
                return 'Development';
            }

            // 通讯工具
            if (name.includes('wechat') || name.includes('qq') || name.includes('telegram') || 
                name.includes('discord') || name.includes('chat') || name.includes('如流') ||
                bundle.includes('chat') || bundle.includes('tencent') || bundle.includes('telegram')) {
                return 'Communication';
            }

            // 媒体工具
            if (name.includes('music') || name.includes('video') || name.includes('player') || 
                name.includes('media') || name.includes('iina') || name.includes('elmedia') ||
                name.includes('handbrake') || name.includes('freetube') || name.includes('wiliwili') ||
                bundle.includes('music') || bundle.includes('media') || bundle.includes('player')) {
                return 'Media';
            }

            // 生产力工具
            if (name.includes('notion') || name.includes('obsidian') || name.includes('notes') || 
                name.includes('goodnotes') || name.includes('notability') || name.includes('writer') ||
                name.includes('paste') || name.includes('copy') || name.includes('clipboard') ||
                bundle.includes('notion') || bundle.includes('obsidian') || bundle.includes('notes')) {
                return 'Productivity';
            }

            // 网络工具
            if (name.includes('chrome') || name.includes('browser') || name.includes('safari') || 
                name.includes('firefox') || name.includes('edge') || name.includes('chromium') ||
                bundle.includes('chrome') || bundle.includes('browser') || bundle.includes('safari')) {
                return 'Browsers';
            }

            // 系统工具
            if (name.includes('cleaner') || name.includes('bartender') || name.includes('alttab') || 
                name.includes('istat') || name.includes('monitor') || name.includes('system') ||
                name.includes('settings') || name.includes('control') || name.includes('activity') ||
                bundle.includes('system') || bundle.includes('monitor') || bundle.includes('stat')) {
                return 'Utilities';
            }

            // 安全工具
            if (name.includes('password') || name.includes('1password') || name.includes('bitwarden') || 
                name.includes('keychain') || name.includes('security') || name.includes('vpn') ||
                name.includes('proxy') || name.includes('firewall') || name.includes('little snitch') ||
                bundle.includes('password') || bundle.includes('security') || bundle.includes('vpn')) {
                return 'Security';
            }

            // 图形设计
            if (name.includes('photoshop') || name.includes('illustrator') || name.includes('design') || 
                name.includes('sketch') || name.includes('figma') || name.includes('canva') ||
                bundle.includes('adobe') || bundle.includes('design') || bundle.includes('graphics')) {
                return 'Design';
            }

            // 网络工具
            if (name.includes('charles') || name.includes('proxyman') || name.includes('wireshark') || 
                name.includes('network') || name.includes('wifi') || name.includes('sniffnet') ||
                bundle.includes('network') || bundle.includes('proxy') || bundle.includes('charles')) {
                return 'Network';
            }

            // 虚拟化
            if (name.includes('docker') || name.includes('parallels') || name.includes('vmware') || 
                name.includes('utm') || name.includes('virtual') ||
                bundle.includes('docker') || bundle.includes('parallels') || bundle.includes('vmware')) {
                return 'Virtualization';
            }

            // 云存储
            if (name.includes('dropbox') || name.includes('drive') || name.includes('cloud') || 
                name.includes('sync') || name.includes('backup') || name.includes('baidu') ||
                name.includes('夸克') || name.includes('网盘') ||
                bundle.includes('cloud') || bundle.includes('sync') || bundle.includes('backup')) {
                return 'Cloud Storage';
            }

            // AI工具
            if (name.includes('chatgpt') || name.includes('claude') || name.includes('ai') || 
                name.includes('ollama') || name.includes('diffusion') || name.includes('fellou') ||
                bundle.includes('openai') || bundle.includes('anthropic') || bundle.includes('ai')) {
                return 'AI Tools';
            }

            // 游戏
            if (name.includes('game') || name.includes('play') || name.includes('steam') || 
                name.includes('epic') || name.includes('ryujinx') || name.includes('playcover') ||
                bundle.includes('game') || bundle.includes('play') || bundle.includes('steam')) {
                return 'Games';
            }

            // 默认返回Other
            return 'Other';
        }

        // 更新统计信息
        function updateStats() {
            const scanInfo = appsData.scan_info;
            const apps = appsData.applications;

            document.getElementById('totalApps').textContent = scanInfo.total_apps;
            
            const categories = [...new Set(apps.map(app => app.category))];
            document.getElementById('totalCategories').textContent = categories.length;
            
            document.getElementById('scanDate').textContent = scanInfo.scan_date.split(' ')[0];
            document.getElementById('systemInfo').textContent = scanInfo.hostname;
        }

        // 填充分类筛选器
        function populateCategoryFilter() {
            const categories = [...new Set(appsData.applications.map(app => app.category))].sort();
            categoryFilter.innerHTML = '<option value="">所有分类</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }

        // 显示应用列表
        function displayApps() {
            appsList.innerHTML = '';
            
            filteredApps.forEach(app => {
                const appCard = document.createElement('div');
                appCard.className = 'app-card fade-in';
                
                const categoryColor = getCategoryColor(app.category);
                appCard.style.borderLeftColor = categoryColor;
                
                appCard.innerHTML = `
                    <div class="app-name">${app.name}</div>
                    <div class="app-info">
                        <div><strong>版本:</strong> ${app.version}</div>
                        <div><strong>大小:</strong> ${app.size}</div>
                        <div><strong>安装时间:</strong> ${app.install_date}</div>
                        <div><strong>Bundle ID:</strong> ${app.bundle_id}</div>
                    </div>
                    <span class="app-category" style="background-color: ${categoryColor}">${app.category}</span>
                `;
                
                appsList.appendChild(appCard);
            });
        }

        // 获取分类颜色
        function getCategoryColor(category) {
            const colors = {
                'System': '#6c757d',
                'Development': '#28a745',
                'Microsoft': '#007bff',
                'Google': '#fd7e14',
                'Communication': '#17a2b8',
                'Media': '#e83e8c',
                'Productivity': '#20c997',
                'Browsers': '#6f42c1',
                'Utilities': '#ffc107',
                'Security': '#dc3545',
                'Design': '#e74c3c',
                'Network': '#3498db',
                'Virtualization': '#9b59b6',
                'Cloud Storage': '#1abc9c',
                'AI Tools': '#f39c12',
                'Games': '#e91e63',
                'Other': '#95a5a6'
            };
            return colors[category] || colors['Other'];
        }

        // 筛选和搜索
        function filterApps() {
            const categoryValue = categoryFilter.value;
            const searchValue = searchBox.value.toLowerCase();
            
            filteredApps = appsData.applications.filter(app => {
                const matchesCategory = !categoryValue || app.category === categoryValue;
                const matchesSearch = !searchValue || app.name.toLowerCase().includes(searchValue);
                return matchesCategory && matchesSearch;
            });
            
            displayApps();
            
            // 如果当前是词云视图，重新生成词云
            if (wordcloudSection.style.display !== 'none') {
                setTimeout(() => {
                    if (isSimpleWordCloud || typeof WordCloud === 'undefined') {
                        generateSimpleWordCloud();
                    } else {
                        generateWordCloud();
                    }
                }, 100);
            }
        }

        // 显示分类统计
        function displayCategoryStats() {
            const categoryStats = document.getElementById('categoryStats');
            const categories = {};
            
            // 统计各分类应用数量
            appsData.applications.forEach(app => {
                categories[app.category] = (categories[app.category] || 0) + 1;
            });
            
            // 按数量排序
            const sortedCategories = Object.entries(categories)
                .sort((a, b) => b[1] - a[1]);
            
            const maxCount = Math.max(...Object.values(categories));
            
            categoryStats.innerHTML = sortedCategories.map(([category, count]) => {
                const percentage = (count / maxCount) * 100;
                const color = getCategoryColor(category);
                
                return `
                    <div class="category-bar">
                        <div class="category-label">${category}</div>
                        <div class="category-bar-fill" style="background-color: ${color}; width: ${percentage}%;">
                            ${count}
                        </div>
                        <div class="category-count">${count}</div>
                    </div>
                `;
            }).join('');
        }

        // 事件监听器
        categoryFilter.addEventListener('change', filterApps);
        searchBox.addEventListener('input', filterApps);

        // 视图切换
        listViewBtn.addEventListener('click', () => {
            switchView('list');
        });

        cloudViewBtn.addEventListener('click', () => {
            switchView('cloud');
        });

        chartViewBtn.addEventListener('click', () => {
            switchView('chart');
        });

        function switchView(view) {
            // 重置所有按钮状态
            listViewBtn.classList.remove('active');
            cloudViewBtn.classList.remove('active');
            chartViewBtn.classList.remove('active');
            
            // 隐藏所有视图
            appsList.style.display = 'none';
            wordcloudSection.style.display = 'none';
            categoryChart.style.display = 'none';
            
            if (view === 'list') {
                listViewBtn.classList.add('active');
                appsList.style.display = 'grid';
            } else if (view === 'cloud') {
                cloudViewBtn.classList.add('active');
                wordcloudSection.style.display = 'block';
                
                // 延迟生成词云，确保容器已显示
                setTimeout(() => {
                    if (isSimpleWordCloud || typeof WordCloud === 'undefined') {
                        generateSimpleWordCloud();
                    } else {
                        generateWordCloud();
                    }
                }, 100);
            } else if (view === 'chart') {
                chartViewBtn.classList.add('active');
                categoryChart.style.display = 'block';
            }
        }

        // 生成词云
        function generateWordCloud() {
            if (!appsData) return;
            
            const canvas = document.getElementById('wordcloud');
            const container = canvas.parentElement;
            
            // 设置canvas尺寸 - 扩大显示区域
            canvas.width = container.clientWidth - 80; // 减去padding
            canvas.height = 700; // 增加高度
            
            const apps = filteredApps.length > 0 ? filteredApps : appsData.applications;
            
            if (apps.length === 0) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#999';
                ctx.font = '20px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('没有数据显示', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            // 准备词云数据 - 使用应用名称和基于分类的权重
            const categoryWeights = {
                'Development': 2.0,
                'AI Tools': 1.9,
                'Design': 1.8,
                'Communication': 1.7,
                'Microsoft': 1.6,
                'Productivity': 1.5,
                'Network': 1.4,
                'Google': 1.3,
                'Browsers': 1.2,
                'Virtualization': 1.2,
                'Security': 1.1,
                'Media': 1.1,
                'Cloud Storage': 1.0,
                'Utilities': 0.9,
                'Games': 0.8,
                'System': 0.7,
                'Other': 0.6
            };
            
            const wordData = apps.map(app => {
                const weight = categoryWeights[app.category] || 1.0;
                // 根据应用重要性和分类调整大小
                let baseSize = 20;
                
                // 重要应用加权
                const importantApps = ['Xcode', 'Visual Studio Code', 'Chrome', 'Safari', 'ChatGPT', 'WeChat', 'QQ'];
                if (importantApps.some(important => app.name.includes(important))) {
                    baseSize += 15;
                }
                
                // 系统应用降权
                if (app.category === 'System' && !app.name.includes('Xcode')) {
                    baseSize -= 5;
                }
                
                // 添加随机变化
                const randomFactor = Math.random() * 20 + 10;
                const finalSize = Math.floor((baseSize + randomFactor) * weight);
                
                return [app.name, Math.max(finalSize, 12)]; // 最小字体大小12
            });

            // 清除之前的词云
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 检查WordCloud是否可用
            if (typeof WordCloud === 'undefined') {
                ctx.fillStyle = '#e74c3c';
                ctx.font = '18px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('词云库加载失败，请检查网络连接', canvas.width / 2, canvas.height / 2 - 10);
                ctx.fillText('或使用本地版本的WordCloud.js', canvas.width / 2, canvas.height / 2 + 20);
                return;
            }

            // 生成词云
            try {
                WordCloud(canvas, {
                    list: wordData,
                    gridSize: Math.round(8 * canvas.width / 800),
                    weightFactor: function (size) {
                        return size * canvas.width / 800;
                    },
                    fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                    color: function (word, weight, fontSize, distance, theta) {
                        // 根据应用分类返回不同颜色
                        const app = apps.find(a => a.name === word);
                        if (app) {
                            const colors = {
                                'Development': '#28a745',
                                'AI Tools': '#f39c12',
                                'Design': '#e74c3c',
                                'Communication': '#17a2b8',
                                'Microsoft': '#007bff',
                                'Productivity': '#20c997',
                                'Network': '#3498db',
                                'Google': '#fd7e14',
                                'Browsers': '#6f42c1',
                                'Virtualization': '#9b59b6',
                                'Security': '#dc3545',
                                'Media': '#e83e8c',
                                'Cloud Storage': '#1abc9c',
                                'Utilities': '#ffc107',
                                'Games': '#e91e63',
                                'System': '#6c757d',
                                'Other': '#95a5a6'
                            };
                            return colors[app.category] || '#95a5a6';
                        }
                        // 备用颜色
                        const fallbackColors = ['#007bff', '#28a745', '#dc3545', '#fd7e14', '#6f42c1', '#e83e8c'];
                        return fallbackColors[Math.floor(Math.random() * fallbackColors.length)];
                    },
                    rotateRatio: 0.3,
                    rotationSteps: 2,
                    backgroundColor: 'transparent',
                    minSize: 12,
                    maxRotation: Math.PI / 6,
                    minRotation: -Math.PI / 6,
                    shuffle: true,
                    drawOutOfBound: false,
                    shrinkToFit: true
                });
                
                // 词云生成成功后显示保存按钮
                document.getElementById('saveWordCloudBtn').style.display = 'block';
            } catch (error) {
                console.error('词云生成错误:', error);
                ctx.fillStyle = '#e74c3c';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('词云生成失败: ' + error.message, canvas.width / 2, canvas.height / 2);
            }
        }

        // 初始化时调整canvas大小
        window.addEventListener('resize', () => {
            if (wordcloudSection.style.display !== 'none') {
                setTimeout(generateWordCloud, 100);
            }
        });

        // 备用词云实现（简单版本）
        function generateSimpleWordCloud() {
            const canvas = document.getElementById('wordcloud');
            const container = canvas.parentElement;
            const ctx = canvas.getContext('2d');
            
            // 设置canvas尺寸 - 扩大显示区域
            canvas.width = container.clientWidth - 80;
            canvas.height = 700; // 增加高度
            
            const apps = filteredApps.length > 0 ? filteredApps : appsData.applications;
            
            if (apps.length === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#999';
                ctx.font = '20px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('没有数据显示', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 简单的网格布局
            const cols = Math.ceil(Math.sqrt(apps.length));
            const rows = Math.ceil(apps.length / cols);
            const cellWidth = canvas.width / cols;
            const cellHeight = canvas.height / rows;
            
            apps.forEach((app, index) => {
                const col = index % cols;
                const row = Math.floor(index / cols);
                const x = col * cellWidth + cellWidth / 2;
                const y = row * cellHeight + cellHeight / 2;
                
                // 根据分类设置颜色和大小
                const categoryColors = {
                    'Development': '#28a745',
                    'AI Tools': '#f39c12',
                    'Design': '#e74c3c',
                    'Communication': '#17a2b8',
                    'Microsoft': '#007bff',
                    'Productivity': '#20c997',
                    'Network': '#3498db',
                    'Google': '#fd7e14',
                    'Browsers': '#6f42c1',
                    'Virtualization': '#9b59b6',
                    'Security': '#dc3545',
                    'Media': '#e83e8c',
                    'Cloud Storage': '#1abc9c',
                    'Utilities': '#ffc107',
                    'Games': '#e91e63',
                    'System': '#6c757d',
                    'Other': '#95a5a6'
                };
                
                const categorySizes = {
                    'Development': 20,
                    'AI Tools': 19,
                    'Design': 18,
                    'Communication': 17,
                    'Microsoft': 16,
                    'Productivity': 15,
                    'Network': 14,
                    'Google': 14,
                    'Browsers': 13,
                    'Virtualization': 13,
                    'Security': 12,
                    'Media': 12,
                    'Cloud Storage': 11,
                    'Utilities': 11,
                    'Games': 10,
                    'System': 10,
                    'Other': 9
                };
                
                ctx.fillStyle = categoryColors[app.category] || '#667eea';
                ctx.font = `${categorySizes[app.category] || 12}px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // 文字太长时截断
                let displayName = app.name;
                if (displayName.length > 15) {
                    displayName = displayName.substring(0, 12) + '...';
                }
                
                ctx.fillText(displayName, x, y);
            });

            // 显示保存按钮
            document.getElementById('saveWordCloudBtn').style.display = 'block';
        }

        // 词云类型切换
        let isSimpleWordCloud = false;
        
        function toggleWordCloudType() {
            isSimpleWordCloud = !isSimpleWordCloud;
            const toggleBtn = document.getElementById('wordcloudToggle');
            
            if (isSimpleWordCloud) {
                toggleBtn.textContent = '高级词云';
                generateSimpleWordCloud();
            } else {
                toggleBtn.textContent = '简单布局';
                generateWordCloud();
            }
        }

        // 检测WordCloud库是否加载成功
        function checkWordCloudLibrary() {
            if (typeof WordCloud === 'undefined') {
                console.warn('WordCloud库未加载，使用简单词云');
                isSimpleWordCloud = true;
                const toggleBtn = document.getElementById('wordcloudToggle');
                if (toggleBtn) {
                    toggleBtn.style.display = 'none';
                }
                return false;
            }
            return true;
        }

        // 页面加载完成后检查库
        window.addEventListener('load', () => {
            setTimeout(checkWordCloudLibrary, 1000);
            createParticles();
        });

        // 下载扫描脚本
        function downloadScanScript() {
            const scriptContent = `#!/bin/bash

# Mac App Scanner - 扫描Mac上安装的软件
# Author: xiebaiyuan
# Date: 2025年8月13日

# 设置输出文件
OUTPUT_FILE="$(dirname "$0")/apps_data.json"
TEMP_FILE="/tmp/mac_apps_temp.txt"

echo "🔍 开始扫描Mac上安装的软件..."

# 获取系统信息
SCAN_DATE=$(date "+%Y-%m-%d %H:%M:%S")
HOSTNAME=$(hostname)
USERNAME=$(whoami)

echo "📱 扫描Applications文件夹..."

# 初始化应用计数
APP_COUNT=0

# 临时存储应用信息
echo "[" > "$TEMP_FILE"

# 扫描/Applications目录
for app in /Applications/*.app; do
    if [ -d "$app" ]; then
        APP_NAME=$(basename "$app" .app)
        
        # 获取应用信息
        INFO_PLIST="$app/Contents/Info.plist"
        
        if [ -f "$INFO_PLIST" ]; then
            # 获取版本信息
            VERSION=$(/usr/libexec/PlistBuddy -c "Print :CFBundleShortVersionString" "$INFO_PLIST" 2>/dev/null || echo "Unknown")
            BUNDLE_ID=$(/usr/libexec/PlistBuddy -c "Print :CFBundleIdentifier" "$INFO_PLIST" 2>/dev/null || echo "Unknown")
            
            # 获取文件大小
            SIZE=$(du -sh "$app" 2>/dev/null | cut -f1 || echo "Unknown")
            
            # 获取创建时间
            INSTALL_DATE=$(stat -f "%Sm" -t "%Y-%m-%d %H:%M:%S" "$app" 2>/dev/null || echo "Unknown")
            
            # 生成应用分类（基于Bundle ID的简单分类）
            CATEGORY="Other"
            case "$BUNDLE_ID" in
                com.apple.*) CATEGORY="System" ;;
                com.microsoft.*) CATEGORY="Microsoft" ;;
                com.adobe.*) CATEGORY="Adobe" ;;
                com.google.*) CATEGORY="Google" ;;
                *developer*|*xcode*|*git*) CATEGORY="Development" ;;
                *game*|*Games*) CATEGORY="Games" ;;
                *music*|*audio*|*video*|*media*) CATEGORY="Media" ;;
                *productivity*|*office*) CATEGORY="Productivity" ;;
                *utility*|*Utility*) CATEGORY="Utilities" ;;
            esac
            
            # 添加逗号（除了第一个应用）
            if [ $APP_COUNT -gt 0 ]; then
                echo "," >> "$TEMP_FILE"
            fi
            
            # 转义JSON字符串中的特殊字符
            APP_NAME_CLEAN=$(echo "$APP_NAME" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            VERSION_CLEAN=$(echo "$VERSION" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            BUNDLE_ID_CLEAN=$(echo "$BUNDLE_ID" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            SIZE_CLEAN=$(echo "$SIZE" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            INSTALL_DATE_CLEAN=$(echo "$INSTALL_DATE" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            PATH_CLEAN=$(echo "$app" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            
            # 写入JSON格式的应用信息
            echo "    {" >> "$TEMP_FILE"
            echo "      \\"name\\": \\"$APP_NAME_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"version\\": \\"$VERSION_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"bundle_id\\": \\"$BUNDLE_ID_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"size\\": \\"$SIZE_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"install_date\\": \\"$INSTALL_DATE_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"category\\": \\"$CATEGORY\\"," >> "$TEMP_FILE"
            echo "      \\"path\\": \\"$PATH_CLEAN\\"" >> "$TEMP_FILE"
            echo -n "    }" >> "$TEMP_FILE"
            
            APP_COUNT=$((APP_COUNT + 1))
            echo "  ✅ 发现: $APP_NAME ($VERSION)"
        fi
    fi
done

# 扫描/System/Applications目录（系统应用）
echo "🖥️  扫描系统应用..."
for app in /System/Applications/*.app; do
    if [ -d "$app" ]; then
        APP_NAME=$(basename "$app" .app)
        
        INFO_PLIST="$app/Contents/Info.plist"
        
        if [ -f "$INFO_PLIST" ]; then
            VERSION=$(/usr/libexec/PlistBuddy -c "Print :CFBundleShortVersionString" "$INFO_PLIST" 2>/dev/null || echo "System")
            BUNDLE_ID=$(/usr/libexec/PlistBuddy -c "Print :CFBundleIdentifier" "$INFO_PLIST" 2>/dev/null || echo "Unknown")
            SIZE=$(du -sh "$app" 2>/dev/null | cut -f1 || echo "Unknown")
            INSTALL_DATE=$(stat -f "%Sm" -t "%Y-%m-%d %H:%M:%S" "$app" 2>/dev/null || echo "Unknown")
            
            if [ $APP_COUNT -gt 0 ]; then
                echo "," >> "$TEMP_FILE"
            fi
            
            # 转义JSON字符串中的特殊字符
            APP_NAME_CLEAN=$(echo "$APP_NAME" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            VERSION_CLEAN=$(echo "$VERSION" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            BUNDLE_ID_CLEAN=$(echo "$BUNDLE_ID" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            SIZE_CLEAN=$(echo "$SIZE" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            INSTALL_DATE_CLEAN=$(echo "$INSTALL_DATE" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            PATH_CLEAN=$(echo "$app" | sed 's/\\\\/\\\\\\\\/g; s/"/\\\\"/g')
            
            # 写入JSON格式的应用信息
            echo "    {" >> "$TEMP_FILE"
            echo "      \\"name\\": \\"$APP_NAME_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"version\\": \\"$VERSION_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"bundle_id\\": \\"$BUNDLE_ID_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"size\\": \\"$SIZE_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"install_date\\": \\"$INSTALL_DATE_CLEAN\\"," >> "$TEMP_FILE"
            echo "      \\"category\\": \\"System\\"," >> "$TEMP_FILE"
            echo "      \\"path\\": \\"$PATH_CLEAN\\"" >> "$TEMP_FILE"
            echo -n "    }" >> "$TEMP_FILE"
            
            APP_COUNT=$((APP_COUNT + 1))
            echo "  ✅ 发现系统应用: $APP_NAME"
        fi
    fi
done

# 完成临时文件
echo "" >> "$TEMP_FILE"
echo "]" >> "$TEMP_FILE"

# 创建最终的JSON文件
cat > "$OUTPUT_FILE" << EOF
{
  "scan_info": {
    "scan_date": "$SCAN_DATE",
    "hostname": "$HOSTNAME",
    "username": "$USERNAME",
    "total_apps": $APP_COUNT
  },
  "applications": 
EOF

# 追加应用数据
cat "$TEMP_FILE" >> "$OUTPUT_FILE"

# 完成JSON文件
echo "}" >> "$OUTPUT_FILE"

# 清理临时文件
rm -f "$TEMP_FILE"

echo ""
echo "🎉 扫描完成！"
echo "📊 总共发现 $APP_COUNT 个应用"
echo "📄 结果保存到: $OUTPUT_FILE"
echo ""
echo "🌐 现在可以打开网页并拖入 apps_data.json 文件查看结果"

# 检查是否需要打开网页
read -p "是否要在浏览器中打开结果页面？(y/n): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    if [ -f "$(dirname "$0")/index.html" ]; then
        open "$(dirname "$0")/index.html"
    else
        echo "❌ 未找到 index.html 文件"
    fi
fi
`;

            // 创建下载链接
            const blob = new Blob([scriptContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'scan_apps.sh';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

        // 显示下载成功提示
            showNotification('📥 扫描脚本下载成功！请在终端中运行：chmod +x scan_apps.sh && ./scan_apps.sh', 'success');
        }

        // 保存词云图片
        function saveWordCloudImage() {
            const canvas = document.getElementById('wordcloud');
            
            if (!canvas) {
                showNotification('❌ 未找到词云画布', 'error');
                return;
            }

            try {
                // 创建一个新的canvas用于高质量导出
                const exportCanvas = document.createElement('canvas');
                const exportCtx = exportCanvas.getContext('2d');
                
                // 设置更高的分辨率
                const scale = 2; // 2倍分辨率
                exportCanvas.width = canvas.width * scale;
                exportCanvas.height = canvas.height * scale;
                
                // 设置白色背景
                exportCtx.fillStyle = '#ffffff';
                exportCtx.fillRect(0, 0, exportCanvas.width, exportCanvas.height);
                
                // 缩放并绘制原始canvas内容
                exportCtx.scale(scale, scale);
                exportCtx.drawImage(canvas, 0, 0);
                
                // 生成文件名
                const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
                const filename = `mac-apps-wordcloud-${timestamp}.png`;
                
                // 转换为blob并下载
                exportCanvas.toBlob(function(blob) {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    showNotification(`💾 词云图片已保存为: ${filename}`, 'success');
                }, 'image/png', 1.0);
                
            } catch (error) {
                console.error('保存图片失败:', error);
                showNotification('❌ 保存图片失败: ' + error.message, 'error');
            }
        }

        // 重新生成词云
        function regenerateWordCloud() {
            if (wordcloudSection.style.display !== 'none') {
                setTimeout(() => {
                    if (isSimpleWordCloud || typeof WordCloud === 'undefined') {
                        generateSimpleWordCloud();
                    } else {
                        generateWordCloud();
                    }
                }, 100);
                
                showNotification('🔄 词云已重新生成', 'info');
            }
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: 'rgba(40, 167, 69, 0.95)',
                error: 'rgba(220, 53, 69, 0.95)',
                info: 'rgba(23, 162, 184, 0.95)',
                warning: 'rgba(255, 193, 7, 0.95)'
            };
            
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: ${colors[type] || colors.info}; color: white; padding: 15px 20px; border-radius: 10px; z-index: 1000; backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,0.2); max-width: 400px; word-break: break-word;">
                    ${message}
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // 创建背景粒子效果
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                createSingleParticle(particlesContainer, i * 1000);
            }
        }

        function createSingleParticle(container, delay = 0) {
            setTimeout(() => {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // 随机大小
                const size = Math.random() * 6 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                // 随机位置
                particle.style.left = Math.random() * 100 + '%';
                
                // 随机动画时长
                const duration = Math.random() * 15 + 15;
                particle.style.animationDuration = duration + 's';
                
                container.appendChild(particle);
                
                // 粒子动画结束后重新创建
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.remove();
                    }
                    createSingleParticle(container);
                }, duration * 1000);
                
            }, delay);
        }
    </script>
</body>
</html>
